<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="http://www.gov.cn/" title="乐信圣文" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="第一节 概述　　Android Support Library是Google官方提供的一组代码库，提供向后兼容版本的Android框架API，若需要在低版本系统中使用高版本中的功能则只能通过该库的API。  　　加入它们后，您的应用程序既可以使用支持库所提供的高版本的特点，并且仍然可以在低版本中运行。 组成  Support库目前包含5个库（v4、v7、v8、v13、v17），其中‘v’代表该支持">
<meta property="og:type" content="article">
<meta property="og:title" content="综合篇 第三章 Android Support Library">
<meta property="og:url" content="http://yoursite.com/android-total-003/index.html">
<meta property="og:site_name" content="乐信圣文">
<meta property="og:description" content="第一节 概述　　Android Support Library是Google官方提供的一组代码库，提供向后兼容版本的Android框架API，若需要在低版本系统中使用高版本中的功能则只能通过该库的API。  　　加入它们后，您的应用程序既可以使用支持库所提供的高版本的特点，并且仍然可以在低版本中运行。 组成  Support库目前包含5个库（v4、v7、v8、v13、v17），其中‘v’代表该支持">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/img/android/android_b07_01.png">
<meta property="og:image" content="http://yoursite.com/img/android/android_b07_02.png">
<meta property="og:image" content="http://yoursite.com/img/android/android_b07_03.png">
<meta property="og:image" content="http://yoursite.com/img/android/android_b07_04.gif">
<meta property="og:image" content="http://yoursite.com/img/android/android_b07_05.png">
<meta property="og:image" content="http://yoursite.com/img/android/android_b07_06.png">
<meta property="og:image" content="http://yoursite.com/img/android/android_b03_01.png">
<meta property="og:image" content="http://yoursite.com/img/android/android_b03_02.png">
<meta property="og:image" content="http://yoursite.com/img/android/android_o03_01.jpg">
<meta property="og:image" content="http://yoursite.com/img/android/android_o06_01.png">
<meta property="og:image" content="http://yoursite.com/img/android/android_o06_02.png">
<meta property="og:image" content="http://yoursite.com/img/android/android_o06_03.png">
<meta property="og:image" content="http://yoursite.com/img/android/android_o06_04.png">
<meta property="og:image" content="http://yoursite.com/img/android/android_o03_02.jpg">
<meta property="og:image" content="http://yoursite.com/img/android/android_o03_03.jpg">
<meta property="og:image" content="http://yoursite.com/img/android/android_o03_04.jpg">
<meta property="og:image" content="http://www.jcodecraeer.com/uploads/20150731/1438306976405961.gif">
<meta property="og:image" content="http://yoursite.com/img/android/android_o03_05.jpg">
<meta property="og:image" content="http://www.jcodecraeer.com/uploads/allimg/150717/1G0543025-1.gif">
<meta property="og:image" content="http://www.jcodecraeer.com/uploads/allimg/150717/1G0541510-7.gif">
<meta property="og:updated_time" content="2019-10-21T04:21:53.758Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="综合篇 第三章 Android Support Library">
<meta name="twitter:description" content="第一节 概述　　Android Support Library是Google官方提供的一组代码库，提供向后兼容版本的Android框架API，若需要在低版本系统中使用高版本中的功能则只能通过该库的API。  　　加入它们后，您的应用程序既可以使用支持库所提供的高版本的特点，并且仍然可以在低版本中运行。 组成  Support库目前包含5个库（v4、v7、v8、v13、v17），其中‘v’代表该支持">
<meta name="twitter:image" content="http://yoursite.com/img/android/android_b07_01.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/android-total-003/"/>

  <title> 综合篇 第三章 Android Support Library | 乐信圣文 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?53b4b0b5aeb5df5e4fb6263a58d8e1a9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">乐信圣文</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-feedback">
          <a href="/feedback" rel="section">
            
            联系我们
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                综合篇 第三章 Android Support Library
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            
              <span class="post-meta-item-text">Cutler</span>
            
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-07-17T19:05:35+08:00" content="2015-07-17">
              2015-07-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android-中级开发/" itemprop="url" rel="index">
                    <span itemprop="name">Android - 中级开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          

          
          
             <span id="/android-total-003/" class="leancloud_visitors" data-flag-title="综合篇 第三章 Android Support Library">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="第一节-概述"><a href="#第一节-概述" class="headerlink" title="第一节 概述"></a>第一节 概述</h1><p>　　<code>Android Support Library</code>是Google官方提供的一组代码库，提供向后兼容版本的Android框架API，若需要在低版本系统中使用高版本中的功能则只能通过该库的API。 </p>
<p>　　加入它们后，您的应用程序既可以使用支持库所提供的高版本的特点，并且仍然可以在低版本中运行。</p>
<p><br><strong>组成</strong></p>
<blockquote>
<p>Support库目前包含5个库（v4、v7、v8、v13、v17），其中‘v’代表该支持库所支持的最低版本的API等级，如v4即指最低支持Android1.6。每个库支持一个特定范围的Android平台版本和功能集。<br>一般来说，我们建议包括v4和v7库到你的应用程序中，因为他们支持广泛的Android版本，并提供API推荐用户界面模式。</p>
</blockquote>
<p><br><strong>下载</strong><br>　　<code>Android Support Library</code>是对SDK的补充，可以使用<code>Android SDK Manager</code>来下载。具体步骤如下：</p>
<pre><code>1.  启动SDK Manager，通过SDK安装的根目录下的SDK Manager.exe文件。
2.  打开SDK Manager然后滚动到最底部，找到“Extras”文件夹并将其展开。
3.  若你使用Eclipse开发项目则需要选择“Android Support Library”，但如果你使用Android Studio开发则需要下载“Android support Repository”。
4.  点击“安装”按钮。
</code></pre><p>　　下载完毕后，这些文件被放入到<code>“&lt;sdk&gt;/extras/android/support/”</code>目录下面。<br><br>　　下面就依次介绍这些支持库的应用场景及特点，你可以依据自己的需求来选择使用哪一个支持库。</p>
<h2 id="V4-支持库"><a href="#V4-支持库" class="headerlink" title="V4 支持库"></a>V4 支持库</h2><p>　　这个支持库是为<code>Android1.6</code>(<code>API Level 4</code>)或更高版本的平台设计的。相比其他库它包括更大量的<code>APIs</code>。包括应用程序组件、用户接口特性、可访问性、数据处理、网络连通性和编程工具。这里有几个关键的类包含在<code>v4</code>库：</p>
<pre><code>-  应用程序组件：
   -  Fragment：增加了支持封装的用户界面和功能的Fragment，使应用程序可以方便的在小和大屏幕设备之间提供布局。
   -  NotificationCompat：可以支持丰富的通知功能。
   -  LocalBroadcastManager：允许应用程序在其内部很容易注册和接收意图，一个私有的广播。
-  用户接口：
   -  ViewPager：增加一个ViewGroup来管理布局里的子View，用户可以通过手指左右滑动在子View之间来回切换。
   -  PagerTitleStrip：PagerTitleStrip是ViewPager的导航栏（不可以点击）。
   -  PagerTabStrip：PagerTitleStrip是ViewPager的导航栏（可以点击）。
   -  DrawerLayout：可以支持创建导航抽屉，可以从一个窗口的边缘。
   -  SlidingPaneLayout：可以用它实现滑动菜单效果，具体参见 http://my.oschina.net/summerpxy/blog/211835 。
-  可访问性：
   -  ExploreByTouchHelper、AccessibilityEventCompat。
   -  AccessibilityNodeInfoCompat、AccessibilityNodeProviderCompat。
   -  AccessibilityDelegateCompat
-  数据处理：
   -  Loader：可以支持异步加载数据。在V4支持库中也提供了这个类的具体实现，包括CursorLoader和AsyncTaskLoader。
   -  FileProvider：可以支持应用程序之间共享的私人文件。
</code></pre><p>　　提示：还有许多其他<code>API</code>包含在这个库中。更详细的介绍，请参看<code>android.support.v4</code>包。这个库放在：<code>&lt;sdk&gt;\extras\android\support\v4</code>目录下。</p>
<h2 id="V7-支持库"><a href="#V7-支持库" class="headerlink" title="V7 支持库"></a>V7 支持库</h2><p>　　除了<code>v4</code>以外，还有一些库设计用于与<code>Android 2.1</code>(<code>API level 7</code>)或更高的平台。v7支持库其实是一组库的集合，它们分别用于不同的场景，其中有几个子库体积比较大，因而不再像<code>v4</code>包那样合在一起，而是将它们分开发布，下面将依次介绍它们。</p>
<p><br><strong>V7 appcompat 库</strong><br>　　这个库添加了对 <a href="http://developer.android.com/guide/topics/ui/actionbar.html" target="_blank" rel="noopener">ActionBar</a> 的支持，同时也支持<code>Android5.0</code>（<code>Android Lollipop</code>）提出的<code>Material Design</code>风格。<br>　　值得注意的是，这个库需要依赖于<code>v4</code>库，如果你使用<code>Ant</code>或者<code>Eclipse</code>，要确保这个库中的类可以引用到<code>v4</code>库中的类。</p>
<p>　　这里有几个关键的类包含在<code>v7 appcompat</code>库：</p>
<pre><code>-  ActionBar：提供了ActionBar的实现。
-  ActionBarActivity：需要使用ActionBar的Activity必须派生自此类。
-  ShareActionProvider：可以支持一个标准化共享行动(比如电子邮件或发布到社交应用程序)，可以包含在操作栏中。
</code></pre><p>　　这个库放在：<code>&lt;sdk&gt;/extras/android/support/v7/appcompat/</code>目录下。</p>
<p><br><strong>V7 cardview 库</strong><br>　　这个库添加了对<code>CardView</code>类的支持，它是<code>Android 5.0</code>推出的一个卡片式的<code>View</code>组件。卡片化是全新的<code>Material</code>风格设计中重要的组成部分之一，卡片设计适合重要信息的展示，以及在<code>List</code>中作为一个包含有复杂操作的<code>item</code>使用。<br>　　<code>CardView</code>继承自<code>FrameLayout</code>类，同时卡片可以包含圆角、阴影。<br>　　经常使用<code>Google APP</code>的人应该对卡片式设计非常熟悉，不管是<code>Google Now</code>、<code>Google Email</code>、<code>Google+</code>等都沿用了卡片式设计的风格，非常清新明了，感觉没有任何冗余的信息。它的具体用法此处就不在展开介绍了。<br>　　这个库放在：<code>&lt;sdk&gt;/extras/android/support/v7/gridlayout/</code>目录下。</p>
<p>效果参看：</p>
<ul>
<li><a href="http://blog.csdn.net/xyz_lmn/article/details/38735117" target="_blank" rel="noopener">《Android L中的RecyclerView 、CardView 、Palette的使用》</a></li>
<li><a href="http://www.yiqivr.com/2015/01/%E4%BD%BF%E7%94%A8cardview%E5%AE%9E%E7%8E%B0%E5%8D%A1%E7%89%87%E5%BC%8Fgoogle-plus%E5%B8%83%E5%B1%80/" target="_blank" rel="noopener">《使用CardView实现卡片式Google Plus布局》</a></li>
</ul>
<p><br><strong>V7 gridlayout 库</strong><br>　　这个库添加了对<code>GridLayout</code>类的支持，它是在<code>Android 4.0</code>中，新引入的一个布局控件。<code>GridLayout</code>可以用来做一个象<code>TableLayout</code>这样的布局样式，但其性能及功能都要比<code>Tablelayout</code>要好，比如<code>GridLayout</code>的布局中的单元格可以跨越多行，而<code>Tablelayout</code>则不行，此外，其渲染速度也比<code>Tablelayout</code>要快。它的具体用法此处就不在展开介绍了。<br>　　这个库放在：<code>&lt;sdk&gt;/extras/android/support/v7/gridlayout/</code>目录下。</p>
<p>效果参看：</p>
<ul>
<li><a href="http://tech.it168.com/a2011/1213/1287/000001287977.shtml" target="_blank" rel="noopener">《Android 4.0开发之GridLayOut布局实践》</a></li>
</ul>
<p><br><strong>V7 mediarouter 库</strong><br>　　这个库添加支持<code>MediaRouter</code>，<code>MediaRouteProvider</code>以及其他相关的媒体类。<br>　　当用户使用无线技术连接电视，家庭影院和音乐播放器时，他们希望<code>android apps</code>的内容可以在这些大屏幕的设备上播放。启用这种方式的播放，能把一台设备一个用户模式变为一个乐于分享的、令人激动和鼓舞的多用户模式。<br>　　android媒体路由（<code>mediarouter</code>）接口被设计成可以在二级设备上呈现和播放媒体。<br>　　这个库放在：<code>&lt;sdk&gt;/extras/android/support/v7/mediarouter/</code>目录下。注意：该库依赖于<code>v7 apcompat</code>库，因此你的项目要同时导入这两个库。</p>
<p>参考阅读：</p>
<ul>
<li><a href="http://blog.csdn.net/go_strive/article/details/19973011" target="_blank" rel="noopener">《media and camera 框架之二： MediaRouter》</a></li>
</ul>
<p><br><strong>V7 palette 库</strong><br>　　这个库添加了对<code>Palette</code>类的支持，它是<code>Android 5.0</code>推出的一个新特性。<code>Palette</code> 可以从一张图片中提取颜色，我们可以把提取的颜色融入到<code>App UI</code>中，可以使<code>UI</code>风格更加美观融洽。比如，我们可以从图片中提取颜色设置给<code>ActionBar</code>做背景颜色，这样<code>ActionBar</code>的颜色就会随着显示图片的变化而变化。<br>　　这个库放在：<code>&lt;sdk&gt;/extras/android/support/v7/palette/</code>目录下。</p>
<p>参考阅读：</p>
<ul>
<li><a href="http://baoyz.com/android/2014/10/21/android-palette-use/" target="_blank" rel="noopener">《Android Lollipop 新特性 - Palette》</a></li>
</ul>
<p><br><strong>V7 recyclerview 库</strong><br>　　这个库添加了对<code>RecyclerView</code>类的支持，它是<code>Android 5.0</code>推出的一个新<code>View</code>组件，用来取代<code>ListView</code>的。<br>　　<code>RecyclerView</code>的特性（但不限于）如下：</p>
<pre><code>-  支持设置横向和纵向显示Item。
-  默认情况下，删除或者增加IteM的时候有动画，当然也可以自定义。
</code></pre><p>　　这个库放在：<code>&lt;sdk&gt;/extras/android/support/v7/recyclerview/</code>目录下。它的具体用法此处就不在展开介绍了。</p>
<h2 id="V8-支持库"><a href="#V8-支持库" class="headerlink" title="V8 支持库"></a>V8 支持库</h2><p>　　这个库设计用于与<code>Android 2.2</code>(<code>API level 8</code>)或更高的平台，它增加了对<code>RenderScript</code>计算框架的支持，这些<code>APIs</code>被包含在<code>android.support.v8.renderscript</code>包中。值得注意的是，包含这个支持库到你项目中的方法不同于其他支持库，更多信息请参看<code>RenderScript</code>开发手册。</p>
<h2 id="V13-支持库"><a href="#V13-支持库" class="headerlink" title="V13 支持库"></a>V13 支持库</h2><p>　　这个库设计用于与<code>Android 3.2</code>(<code>API level 13</code>)或更高的平台。它增加了对<code>FragmentCompat</code>类的支持，以及更多与<code>Fragment</code>相关的支持类。<br>　　这个库放在：<code>&lt;sdk&gt;/extras/android/support/v13/</code>目录下。</p>
<p><br><strong>本节参考阅读：</strong></p>
<ul>
<li><a href="http://developer.android.com/tools/support-library/index.html" target="_blank" rel="noopener">Support Library</a></li>
</ul>
<h2 id="Multidex-支持库"><a href="#Multidex-支持库" class="headerlink" title="Multidex 支持库"></a>Multidex 支持库</h2><p>　　随着Android的不断发展，不论是官方还是<code>Github</code>上都出现了大量的新功能、新类库。如果你是一名幸运的Android应用开发者，正在开发一个前景广阔的应用，那么当你不断地加入新功能、添加新的类库，并达到一定规模时，就会遇到下面的构建错误，它表明你的应用已经达到了一个Android应用程序构建架构的限制。早期版本的构建系统报告这个错误如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Conversion to Dalvik format failed:</span><br><span class="line">Unable to execute dex: method ID <span class="keyword">not</span> in [<span class="number">0</span>, <span class="number">0xffff</span>]: <span class="number">65536</span></span><br></pre></td></tr></table></figure></p>
<p>　　最近版本的Android构建系统会显示一个不同的错误信息，但它们是一个同样的问题:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">trouble writing output:</span><br><span class="line">Too many field references: <span class="number">131000</span>; max is <span class="number">65536.</span></span><br><span class="line">You may <span class="keyword">try</span> <span class="keyword">using</span> --multi-dex option.</span><br></pre></td></tr></table></figure></p>
<p><br>　　这两个错误条件显示一个共同的数字：<code>65536</code>。这个数字很重要，因为它代表了“方法的总数”。Android平台的Java虚拟机<code>Dalvik</code>在执行<code>DEX</code>格式的Java应用程序时，使用原生类型<code>short</code>来索引<code>DEX</code>文件中的方法。这意味着单个<code>DEX</code>文件可被引用的方法总数被限制为<code>65536</code>。通常<code>APK</code>包含一个<code>classes.dex</code>文件，因此Android应用的方法总数不能超过这个数量，这个数量是Android框架、第三方类库和你自己开发的代码的总和。如果你已经建立了一个Android应用，并且收到了这个错误，那么恭喜你，你的方法数已经超过了这个限制。</p>
<p>　　这个问题可以通过将一个<code>DEX</code>文件分拆成多个<code>DEX</code>文件解决。在<code>Facebook</code>、<code>Android Developers</code>博客等地方，介绍了通过自定义类加载过程的方法来解决此问题，但这些方法有些复杂而且并不优雅。</p>
<p>　　随着新的<code>MultiDex支持库</code>发布，<code>Google</code>正式为解决此问题提供了官方支持，<a href="http://developer.android.com/tools/building/multidex.html" target="_blank" rel="noopener">《Building Apps with Over 65K Methods》</a>介绍了如何使用<code>Gradle</code>构建多<code>DEX</code>应用。</p>
<p><br><strong>在Android 5.0是个分水岭</strong></p>
<p>　　<code>Android 5.0</code>之前版本的平台使用的<code>Dalvik</code>执行应用程序代码。默认情况下，<code>Dalvik</code>限制每<code>APK</code>文件只能有一个<code>classes.dex</code>的字节码。为了绕过这个限制，您可以使用<code>Multidex支持库</code>，它允许你的<code>APK</code>中包含多个<code>dex</code>文件。</p>
<p>　　<code>Android 5.0</code>和<code>更高版本</code>使用<code>ART</code>来执行应用程序代码，它原生支持从<code>APK</code>文件加载多个<code>DEX</code>文件。在应用安装时，它会执行预编译，扫描<code>classes(..N).dex</code>文件然后将其编译成单个<code>.oat</code>文件用于执行。</p>
<p><br><strong>仍需控制项目大小</strong></p>
<p>　　虽然<code>Google</code>解决了应用总方法数限制的问题，但并不意味着开发者可以任意扩大项目规模。<code>Multidex</code>仍有一些限制：</p>
<pre><code>1、DEX文件安装到设备的过程非常复杂，如果第二个DEX文件太大，可能导致应用无响应。
2、由于Dalvik linearAlloc的Bug，应用可能无法在Android 4.0之前的版本启动，如果你的应用要支持这些版本就要多测试。
3、同样因为Dalvik linearAlloc的限制，如果请求大量内存可能导致崩溃。Dalvik linearAlloc是一个固定大小的缓冲区。在应用的安装过程中，系统会运行一个名为dexopt的程序为该应用在当前机型中运行做准备。dexopt使用LinearAlloc来存储应用的方法信息。Android 2.2和2.3的缓冲区只有5MB，Android 4.x提高到了8MB或16MB。当方法数量过多导致超出缓冲区大小时，会造成dexopt崩溃。
4、Multidex构建工具还不支持指定哪些类必须包含在首个DEX文件中，因此可能会导致某些类库（如某个类库需要从原生代码访问Java代码）无法使用。
</code></pre><p><br>　　避免应用过大、方法过多仍然是Android开发者要注意的问题。<code>Mihai Parparita</code>的开源项目<a href="https://github.com/mihaip/dex-method-counts" target="_blank" rel="noopener"> dex-method-counts </a>可以用于统计<code>APK</code>中每个包的方法数量。通常开发者自己的代码很难达到这样的方法数量限制，但随着第三方类库的加入，方法数就会迅速膨胀。因此选择合适的类库对Android开发者来说尤为重要。</p>
<p>　　开发者应该避免使用<code>Google Guava</code>这样的类库，它包含了<code>13000</code>多个方法。尽量使用专为移动应用设计的<code>Lite/Android</code>版本类库，或者使用小类库替换大类库，例如用<code>Google-gson</code>替换<code>Jackson JSON</code>。而对于<code>Google Protocol Buffers</code>这样的数据交换格式，其标准实现会自动生成大量的方法。采用<code>Square Wire</code>的实现则可以很好地解决此问题。</p>
<p><br><strong>本节参考阅读：</strong></p>
<ul>
<li><a href="http://www.infoq.com/cn/news/2014/11/android-multidex" target="_blank" rel="noopener">Android应用打破65K方法数限制</a></li>
</ul>
<h1 id="第二节-ActionBar-和-Toolbar"><a href="#第二节-ActionBar-和-Toolbar" class="headerlink" title="第二节 ActionBar 和 Toolbar"></a>第二节 ActionBar 和 Toolbar</h1><p>　　在<code>Android 3.0</code>中除了<code>Fragment</code>外，<code>ActionBar</code>也是一个重要的内容。<code>ActionBar</code>主要是用于代替传统的标题栏与Menu按钮：</p>
<pre><code>-  标题栏：使用ActionBar来做标题栏，可以展示更多丰富的内容，且方便操控。
-  Menu按钮：
   -  在Android 3.0系统之前，Android手机有一个专门的Menu按钮用于打开设置选项。
   -  从Android 3.0系统开始，系统通过引进ActionBar移除了系统对于硬件Menu按钮的依赖，让用户在屏幕的标题栏上直接可以看到各种设置选项。当然，这不意味着OEM厂商们不会继续在手机上提供这个按钮，但从Google的角度来说，Menu按钮已经是过去时了。
</code></pre><h2 id="ActionBar"><a href="#ActionBar" class="headerlink" title="ActionBar"></a>ActionBar</h2><p>　　本节将以添加<code>V7 appcompat</code>库的方式来讲解如何使用<code>ActionBar</code>。</p>
<p>　　<code>ActionBar</code>有多种形式，你既可以在上面同时放置多个图标、按钮，也可以什么都不放。但对于大多数应用来说，<code>ActionBar</code>可以分割为<code>3</code>个不同的功能区域，下面是一张使用<code>ActionBar</code>的界面截图：</p>
<center><br><img src="/img/android/android_b07_01.png" alt="ActionBar示意图"><br></center>

<p>　　其中，<code>[1]</code>是<code>ActionBar</code>的图标与标题，<code>[2]</code>是两个<code>action</code>按钮，<code>[3]</code>是<code>overflow</code>按钮（就是那三个点，点击后会打开一个列表）。<br><br>　　提示：</p>
<pre><code>-  如果你使用的是Eclipse，并且搭建了最新的开发环境，那么在创建新项目的时候，会自动引入v7 appcompat库，如果没有自动引用，可以从&lt;sdk&gt;/extras/android/support/v7/appcompat/中复制一份。
</code></pre><h3 id="图标和标题"><a href="#图标和标题" class="headerlink" title="图标和标题"></a>图标和标题</h3><p><br>　　下图展示的是一个新项目的<code>MainActivity</code>在<code>三星S5</code>手机（左）以及<code>Android2.2模拟器</code>（右）中的运行效果。</p>
<center><br><img src="/img/android/android_b07_02.png" alt="图1"><br></center>

<p><br>　　从上图中我们可以看到，当<code>ActionBar</code>运行在<code>Android3.0</code>以下的版本中时，标题栏的右上角不会出现<code>overflow</code>按钮，但是我们可以通过点击设备的<code>Menu</code>按钮来弹出<code>overflow</code>菜单。也就是说<code>Android3.0</code>中的<code>overflow</code>按钮就等价于<code>Android3.0</code>之前的<code>Menu</code>按钮。（不过，即便系统版本高于<code>Android3.0</code>也不一定保证会显示<code>overflow</code>按钮，具体后述）。<br>　　现在我们要实现如下图所示的一个效果：</p>
<center><br><img src="/img/android/android_b07_03.png" alt="图2"><br></center>

<p><br>　　由于<code>ActionBar</code>在不同的Android版本中显示的效果是不一样的，因此为了提供统一的视觉效果，我们接下来要修改一下<code>ActionBar</code>的背景图片。<br>　　范例1：修改背景图片。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改ActionBar的背景图片。</span></span><br><span class="line">        getSupportActionBar().setBackgroundDrawable(getResources().getDrawable(R.drawable.bg_topbar));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 以下省略其它代码。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  getSupportActionBar()方法继承自android.support.v7.app.AppCompatActivity类。
-  getSupportActionBar()方法返回一个ActionBar对象，我们可以通过这个对象来修改ActionBar的样式。
-  ActionBar的setBackgroundDrawable()方法就是用来修改背景图片的。
</code></pre><p><br>　　<code>ActionBar</code>支持两个文本标题，在上面的被称为主标题（<code>title</code>），在下面的被称为子标题（<code>subTitle</code>）。<br>　　范例2：修改标题文本。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改ActionBar的背景图片。</span></span><br><span class="line">        getSupportActionBar().setBackgroundDrawable(getResources().getDrawable(R.drawable.bg_topbar));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改标题文字。</span></span><br><span class="line">        getSupportActionBar().setTitle(<span class="string">"店小二。"</span>);</span><br><span class="line">        getSupportActionBar().setSubtitle(<span class="string">"陌陌号：18204884"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 以下省略其它代码。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  调用setTitle()方法来设置标题文本。
-  调用setSubtitle()方法来设置子标题文本。如果不设置子标题，则默认只显示主标题，且是垂直居中。
-  调用getSupportActionBar().setDisplayShowTitleEnabled(false);可以同时隐藏两个标题。
-  调用getSupportActionBar().setDisplayShowHomeEnabled(true);显示图标。
-  调用getSupportActionBar().setIcon(R.drawable.ic_launcher);设置图标。
</code></pre><p><br>　　仔细观察上面的<code>图1</code>可以发现，当程序运行在<code>三星S5</code>手机上时，标题的字体颜色为<code>白色</code>，而运行在<code>Android2.2模拟器</code>时，颜色则为<code>黒色</code>。这个情况肯定是不能忍的，需要给它们设置一个统一的颜色。<br>　　为了方便管理与更新，我们不会去直接修改<code>V7 appcompat</code>库里的属性，而是在自己项目里创建一个<code>res\values\custom_actionbar.xml</code>文件，并在该文件中创建一些与<code>V7 appcompat</code>库中同名的属性，即用我们的值覆盖掉它们的值。</p>
<p>　　范例3：修改字体颜色。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 基本的主题 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 定义主题，继承自@style/AppTheme。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"MyActionBarTheme"</span> <span class="attr">parent</span>=<span class="string">"@style/AppTheme"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"actionBarStyle"</span>&gt;</span>@style/MyActionBar<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 定义ActionBar的样式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"MyActionBar"</span> <span class="attr">parent</span>=<span class="string">"@style/Widget.AppCompat.ActionBar"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- 背景色 --&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"background"</span>&gt;</span>@android:color/black<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- 主标题的字体样式 --&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"titleTextStyle"</span>&gt;</span>@style/MyActionBarTitleText<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- 子标题的字体样式 --&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"subtitleTextStyle"</span>&gt;</span>@style/MyActionBarSubtitleText<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"MyActionBarTitleText"</span> <span class="attr">parent</span>=<span class="string">"@style/Base.TextAppearance.AppCompat.Title"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span>&gt;</span>#5ec0e8<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>13sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"MyActionBarSubtitleText"</span> <span class="attr">parent</span>=<span class="string">"@style/Base.TextAppearance.AppCompat.Subhead"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span>&gt;</span>#cccfff<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>8sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  首先，定义一个名为MyActionBarTheme的主题，并为该主题指定了新的ActionBar样式。
-  然后，又为ActionBar指定了背景色、主标题、子标题的样式。
-  最后，就可以在清单文件中为某个Activity使用这个主题了。
</code></pre><h3 id="ActionButton"><a href="#ActionButton" class="headerlink" title="ActionButton"></a>ActionButton</h3><p>　　前面已经说了，在<code>Android3.0</code>之后菜单被移到了标题栏上，以便用户直接可以看到各种设置选项。<br>　　<code>ActionButton</code>相当于之前<code>Menu</code>菜单下的一个菜单项（<code>MenuItem</code>），它也包含一个<code>图标</code>和<code>文字</code>，同时它会直接显示在<code>ActionBar</code>上。当然，如果按钮过多导致<code>ActionBar</code>上显示不完，多出的一些按钮可以隐藏在<code>overflow</code>里面，点击一下<code>overflow</code>按钮就可以看到全部的<code>ActionButton</code>了。</p>
<p>　　现在我们要实现如下图所示的一个效果：</p>
<center><br><img src="/img/android/android_b07_04.gif" alt=""><br></center>


<p><br>　　范例1：创建菜单文件（<code>res\menu\main.xml</code>）。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/action_plus"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@drawable/actionbar_add_icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">"@string/action_plus"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">"always"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/action_album"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@drawable/ofm_photo_icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">"我的相册"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">"never"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/action_collection"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@drawable/ofm_collect_icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">"我的收藏"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">"never"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/action_card"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@drawable/ofm_card_icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">"我的银行卡"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">"never"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/action_settings"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@drawable/ofm_setting_icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">"设置"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">"never"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/action_feed"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">"@drawable/ofm_feedback_icon"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">"意见反馈"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:showAsAction</span>=<span class="string">"never"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  各个Activity的Actionbar里包含的选项可能是不同的，因而每个Activity会有一个对应的menu.xml文件。
-  在menu.xml中，每一个&lt;item&gt;标签都表示一个ActionButton。
-  其中android:id、android:icon、android:title依次表示ActionButton的id、图标、文本标题。
-  其中app:showAsAction属性用来设置ActionButton显示的位置，注意这个属性是在app命名空间里的。常用取值为：
   -  always：表示永远显示在ActionBar中，如果屏幕空间不够则无法显示。
   -  ifRoom：表示屏幕空间够的情况下显示在ActionBar中，不够的话就显示在overflow中。
   -  never：则表示永远显示在overflow中。
</code></pre><p><br>　　范例2：将菜单添加到Activity的<code>ActionBar</code>中。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></span><br><span class="line">    getMenuInflater().inflate(R.menu.main, menu); </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  在MainActivity中重写此方法即可，当Activity检测到它自己没有创建过菜单时，就会调用此方法，此方法只会调用一次。系统会根据方法的返回值做出相应的反应：
   -  返回true意味着菜单已初始化完毕，系统会在ActionBar中显示出overflow按钮。
   -  返回false意味着菜单没被初始化，此时ActionBar中则不会出现overflow按钮。
-  MenuInflater类是一个用来将菜单文件加载并解析为一个Menu对象的工具类。调用Activity的getMenuInflater()方法可以获取一个MenuInflater对象。   
</code></pre><p><br>　　范例3：响应菜单项的点击事件。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Handle action bar item clicks here. The action bar will</span></span><br><span class="line">    <span class="comment">// automatically handle clicks on the Home/Up button, so long</span></span><br><span class="line">    <span class="comment">// as you specify a parent activity in AndroidManifest.xml.</span></span><br><span class="line">    <span class="keyword">int</span> id = item.getItemId();</span><br><span class="line">    <span class="keyword">switch</span>(id)&#123;</span><br><span class="line">    <span class="keyword">case</span> R.id.action_album:</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"我的相册"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> R.id.action_plus:</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"加号被点击"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  当用户选择了选项菜单中的一个菜单项（也包括ActionBar中的ActionButton），系统会调用Activity的onOptionsItemSelected()方法。这个方法把用户选择的菜单项作为参数来传递。你能够通过调用getItemId()方法来识别菜单项，这个方法返回了对象菜单项的唯一ID（这个ID是在菜单资源的android:id属性中定义的，或者是传递给add方法的一个整数）。你能够把这个ID与已知的菜单项匹配，让它执行对应的动作。
-  在MainActivity中重写此方法即可。
</code></pre><p><br>　　前面说了，即使手机系统版本高于<code>Android3.0</code>，也不保证在<code>ActionBar</code>中一定会显示出<code>overflow</code>按钮。<br>　　<a href="http://blog.csdn.net/guolin_blog/article/details/18234477" target="_blank" rel="noopener">《Android ActionBar完全解析，使用官方推荐的最佳导航栏(上)》</a> 中解释了，即<code>overflow</code>按钮的显示情况和手机的硬件情况是有关系的，如果手机没有物理<code>Menu</code>键的话，<code>overflow</code>按钮就可以显示，如果有物理<code>Menu</code>键的话（比如Android模拟器都有物理<code>Menu</code>键），<code>overflow</code>按钮就不会显示出来。</p>
<p><br>　　范例4：显示出<code>overflow</code>按钮。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setOverflowShowingAlways</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ViewConfiguration config = ViewConfiguration.get(<span class="keyword">this</span>);</span><br><span class="line">        Field menuKeyField = ViewConfiguration.class.getDeclaredField(<span class="string">"sHasPermanentMenuKey"</span>);</span><br><span class="line">        menuKeyField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        menuKeyField.setBoolean(config, <span class="keyword">false</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  在Activity的onCreate()方法的最后一行调用setOverflowShowingAlways()方法即可。
-  在ViewConfiguration这个类中有一个叫做sHasPermanentMenuKey的静态变量，系统就是根据这个变量的值来判断手机有没有物理Menu键的。本范例就是使用反射的方式将sHasPermanentMenuKey的值设置成false。
</code></pre><p><br>　　如果你此时运行程序，然后点击<code>overflow</code>按钮，你会发现里面的<code>ActionButton</code>都是只显示文字不显示图标的。这是官方的默认效果，但我们可以通过反射来改变这一默认行为。</p>
<p><br>　　范例5：让菜单项显示图标。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onMenuOpened</span><span class="params">(<span class="keyword">int</span> featureId, Menu menu)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (featureId == Window.FEATURE_ACTION_BAR &amp;&amp; menu != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (menu.getClass().getSimpleName().equals(<span class="string">"MenuBuilder"</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Method m = menu.getClass().getDeclaredMethod(<span class="string">"setOptionalIconsVisible"</span>, Boolean.TYPE);</span><br><span class="line">                m.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                m.invoke(menu, <span class="keyword">true</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onMenuOpened(featureId, menu);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  直接在Activity中重写onMenuOpened()方法即可。
-  由MenuBuilder这个类的setOptionalIconsVisible()方法来决定overflow中的ActionButton应不应该显示图标，如果我们在overflow被展开的时候给这个方法传入true，那么里面的每一个ActionButton对应的图标就都会显示出来了。
</code></pre><p><br>　　最后，来我们就要修改一下<code>overflow</code>菜单以及其内的各个<code>ActionButtom</code>的样式了，比如字体颜色等。</p>
<p><br>　　范例6：修改样式。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- overflow弹出菜单的样式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Base.Widget.AppCompat.ListPopupWindow"</span> <span class="attr">parent</span>=<span class="string">""</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- 菜单默认弹出的位置是0，此处将它在垂直方向的偏移量设置为52dp，即让弹出菜单向下移动一些位置 --&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:dropDownVerticalOffset"</span>&gt;</span>52dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- 弹出菜单的背景图片 --&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:popupBackground"</span>&gt;</span>@drawable/bg_dropmenu_topbar<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- overflow弹出菜单内部的样式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Base.Widget.AppCompat.ListView.DropDown"</span> <span class="attr">parent</span>=<span class="string">"android:Widget.ListView"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- overflow弹出菜单内部，每个Item之间的分割线 --&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:divider"</span>&gt;</span>@drawable/ic_divider<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="comment">&lt;!-- overflow弹出菜单内部，每个Item的selector --&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:listSelector"</span>&gt;</span>@drawable/actionbar_item_selector<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- overflow出菜单内部的每个Item的字体颜色与大小 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Base.TextAppearance.AppCompat.Menu"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>16sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span>&gt;</span>@android:color/black<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><br>　　范例7：现在我们要实现如下图所示的一个效果：</p>
<center><br><img src="/img/android/android_b07_05.png" alt=""><br></center>

<p><br>　　上图中添加了两个新修改，一个是标题栏左边的<code>“←”</code>，另一个是<code>overflow</code>按钮左边是一个文本的<code>ActionButton</code>。</p>
<pre><code>-  前者，调用getSupportActionBar().setDisplayHomeAsUpEnabled(true);即可。
   -  当它被点击时同样会调用onOptionsItemSelected()方法，菜单项id为android.R.id.home。
-  后者，在main.xml文件中，只为&lt;item&gt;标签指定android:title属性，而不指定android:icon属性即可。
</code></pre><p>　　下面是文本<code>ActionButton</code>相关的样式：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 字体的大小、背景selector</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"Base.Widget.AppCompat.ActionButton"</span> <span class="attr">parent</span>=<span class="string">""</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>14sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:background"</span>&gt;</span>@drawable/actionbar_text_actionbtn_selector<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="自定义布局"><a href="#自定义布局" class="headerlink" title="自定义布局"></a>自定义布局</h3><p>　　<code>ActionBar</code>为用户提供了统一方式来展示操作和导航，但是这并不意味着你的<code>app</code>要看起来和其他<code>app</code>一样，我们可以自定义自己的布局。<br>　　将<code>ActionBar</code>划分为如下所示的4个区域：</p>
<center><br><img src="/img/android/android_b07_06.png" alt=""><br></center>

<p>　　其中：</p>
<pre><code>-  1表示返回按钮和图标。
-  2表示标题
-  3表示ActionButton、ActionProvider、ActionView。
-  4表示Overflow按钮。
</code></pre><p><br>　　我们可以通过调用如下代码来自定义<code>ActionBar</code>的布局：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getSupportActionBar().setDisplayShowCustomEnabled(<span class="keyword">true</span>);</span><br><span class="line">getSupportActionBar().setCustomView(R.layout.common_title);</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  自定义的布局将显示在上图中“2”的位置，如果你把其他三个位置都给隐藏掉，那么我们自定义的布局将占据整个ActionBar的空间。
</code></pre><p><br>　　<code>ActionBar</code>的高级用法（<code>ActionView</code>、<code>ActionProvider</code>），笔者不打算继续介绍了，下面的参考阅读中都有。</p>
<p><br><strong>本节参考阅读：</strong></p>
<ul>
<li><a href="http://blog.csdn.net/wangjinyu501/article/details/9360801" target="_blank" rel="noopener">Android ActionBar使用介绍</a></li>
<li><a href="http://blog.csdn.net/guolin_blog/article/details/18234477" target="_blank" rel="noopener">Android ActionBar完全解析，使用官方推荐的最佳导航栏(上)</a></li>
<li><a href="http://blog.csdn.net/guolin_blog/article/details/25466665" target="_blank" rel="noopener">Android ActionBar完全解析，使用官方推荐的最佳导航栏(下)</a></li>
<li><a href="http://stackoverflow.com/questions/12387345/how-to-center-align-the-actionbar-title-in-android" target="_blank" rel="noopener">How to center align the ActionBar title in Android?</a></li>
<li><a href="http://www.oschina.net/question/54100_34400" target="_blank" rel="noopener">Android-Action Bar使用方法-活动栏(一)</a></li>
</ul>
<h2 id="Toolbar"><a href="#Toolbar" class="headerlink" title="Toolbar"></a>Toolbar</h2><p>　　<code>Toolbar</code>是<code>Android 5.0</code>中新引入的一个控件，其出现的目的就是为了取代<code>ActionBar</code>。<br><br>　　<strong>为什么要替换ActionBar呢？</strong></p>
<p>　　因为ActionBar是属于应用UI的一部分，但是我们却又不能对其完全控制：</p>
<pre><code>-  ActionBar是由系统创建并对其进行相关参数的初始化。
-  ActionBar限制多、定制困难（比如标题居中、修改字体样式等）。
</code></pre><p>　　基于这两点（但不限于），Google在<code>Android 5.0</code>后推出了<code>Toolbar</code>。</p>
<p><br>　　这里先说一下，Toolbar所带来的自由性与其本身的定位密不可分，因为它是一个<code>ViewGroup</code>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Toolbar</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 此处省略了Toolbar内的代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br>　　既然Toolbar是用来替代ActionBar的，那么就意味着之前ActionBar能实现的功能，Toolbar也能实现，下面就来介绍它。</p>
<p><br>　　范例1：添加Gradle依赖。<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:appcompat-v7:23.1.1'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  由于Toolbar被放到了appcompat-v7库中，所以我们需要先引用该库。
</code></pre><p><br>　　回想一下，我们以前使用ActionBar时，都会让项目的<code>AppTheme</code>去继承ActionBar的主题，比如：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Base application theme. --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>　　接着，会再让Application去使用这个主题，这样项目里的所有Activity里就会显示出ActionBar了：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">"@style/AppTheme"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><br>　　不过，如果想用Toolbar来替代ActionBar，则就需要修改<code>AppTheme</code>主题了：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  这么做是为了不让Toolbar和ActionBar的样式起冲突。
-  当然也可以不修改AppThem，而是直接在清单文件的activity标签上修改。
</code></pre><p><br>　　范例2：在布局文件中创建Toolbar。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/mToolbar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  因为Toolbar是一个ViewGroup，所以可以直接在布局文件中使用它。
-  此时的Toolbar可能没有背景色，后面会介绍如何给它设置。
</code></pre><p><br>　　范例3：Activity的代码。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        Toolbar toolbar = (Toolbar) findViewById(R.id.mToolbar);</span><br><span class="line">        <span class="comment">// 将toolbar做为ActionBar设置到Activity中。</span></span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></span><br><span class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Handle action bar item clicks here. The action bar will</span></span><br><span class="line">        <span class="comment">// automatically handle clicks on the Home/Up button, so long</span></span><br><span class="line">        <span class="comment">// as you specify a parent activity in AndroidManifest.xml.</span></span><br><span class="line">        <span class="keyword">int</span> id = item.getItemId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">        <span class="keyword">if</span> (id == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  注意，这里继承的是AppCompatActivity类，第10行调用的setSupportActionBar方法也是继承自该类。
-  另外，onCreateOptionsMenu方法返回的菜单同样会被放到Toolbar中。
</code></pre><p><br>　　范例4：修改标题栏。</p>
<center><br><img src="/img/android/android_b03_01.png" alt="Android2.2模拟器上的运行效果图"><br></center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    Toolbar toolbar = (Toolbar) findViewById(R.id.mToolbar);</span><br><span class="line">    setSupportActionBar(toolbar);</span><br><span class="line">    </span><br><span class="line">    toolbar.setTitle(<span class="string">"店小二"</span>);</span><br><span class="line">    toolbar.setSubtitle(<span class="string">"陌陌号：18204884"</span>);</span><br><span class="line">    <span class="comment">// 设置一个不可点击图标。</span></span><br><span class="line">    toolbar.setLogo(R.mipmap.ic_launcher);</span><br><span class="line">    <span class="comment">// 设置一个可以点击的图片，即上图最左侧的那个“三条横线”的图。</span></span><br><span class="line">    toolbar.setNavigationIcon(R.drawable.ic_menu);</span><br><span class="line">    toolbar.setNavigationOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"AAA"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>语句解释：
-  有两点需要注意：
   -  第一，要先调用setSupportActionBar，然后再调用setNavigationOnClickListener才会有效果。
   -  第二，如果执行本代码时，发现标题并没有变成“店小二”，则有两个方法可以解决：
      -  1、将第8行代码放到第6行之前。
      -  2、将第8行代码改成getSupportActionBar().setTitle()。
      -  这是因为当我们把toolbar设置到Activity上之后，调用toolbar的某些方法进行修改，是无法反映到Activity中的。
</code></pre><p><br>　　范例5：修改字体颜色。</p>
<center><br><img src="/img/android/android_b03_02.png" alt="属性对应图"><br></center>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.NoActionBar"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--导航栏背景色--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimary"</span>&gt;</span>#2196F3<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--状态栏背景色--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimaryDark"</span>&gt;</span>#1976D2<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--导航栏上的主标题颜色--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColorPrimary"</span>&gt;</span>@android:color/white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--导航栏上的子标题颜色--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColorSecondary"</span>&gt;</span>@android:color/white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--Activity的背景色--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@android:color/white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>语句解释：
-  上面设置的色值会作用于整个项目，以textColorPrimary和textColorSecondary为例：
   -  为它们设置颜色之后，不止会影响Toolbar的标题的颜色，还会影响到其他多个地方的字体颜色。
   -  因此笔者不推荐通过修改它们二者来达到修改标题栏字体的目的。
   -  而应该使用Toolbar提供的setTitleTextColor和setSubtitleTextColor方法去修改。
-  windowBackground会影响使用此主题的所有Activity（但不限于Activity）的背景色，使用时也要注意。
</code></pre><p><br>　　由于Toolbar自带的设置会覆盖上面的<code>colorPrimary</code>，所以还需要修改一下它：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/mToolbar"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"?colorPrimary"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>　　其中<code>?colorPrimary</code>表示引用当前主题下的<code>colorPrimary</code>属性的值，也可以写成<code>?attr/colorPrimary</code>。</p>
<p><br>　　范例6：修改overflow菜单样式。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"PopupMenu"</span> <span class="attr">parent</span>=<span class="string">"ThemeOverlay.AppCompat.Light"</span> &gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--菜单背景色--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:colorBackground"</span>&gt;</span>#0000ff<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span>&gt;</span>#ffffff<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>10sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>　　然后在布局文件中设置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/mToolbar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"?attr/colorPrimary"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:popupTheme</span>=<span class="string">"@style/PopupMenu"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  使用popupTheme属性设置菜单的样式。
</code></pre><p><br>　　范例7：自定义Toolbar。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/mToolbar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"?attr/colorPrimary"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:popupTheme</span>=<span class="string">"@style/PopupMenu"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"Title"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textColor</span>=<span class="string">"@android:color/white"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">"22sp"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  由于Toolbar是一个ViewGroup，因此直接在Toolbar标签里添加控件即可。
-  本范例用于创建一个标题居中的Toolbar，在执行之前还需要在Activity里把原有的标题给隐藏了：
   -  getSupportActionBar().setDisplayShowTitleEnabled(false);
</code></pre><p><br><br>　　上面只是列举了Toolbar的基本用法，更高级的应用请阅读：<a href="http://cutler.github.io/android-O03/" target="_blank" rel="noopener">《实战篇　第三章 开源库》</a>。</p>
<p><br><strong>本节参考阅读：</strong></p>
<ul>
<li><a href="http://blog.csdn.net/aigestudio/article/details/47090167" target="_blank" rel="noopener">Toolbar：上位的小三</a></li>
<li><a href="http://my.oschina.net/xesam/blog/356855" target="_blank" rel="noopener">【Android】Toolbar</a></li>
<li><a href="http://www.codes9.com/mobile-development/android/android-self-study-course-manterial-design-toolbar2-3/" target="_blank" rel="noopener">Android Self study course (manterial design)—Toolbar(2)</a></li>
</ul>
<h1 id="第二节-DrawerLayout"><a href="#第二节-DrawerLayout" class="headerlink" title="第二节 DrawerLayout"></a>第二节 DrawerLayout</h1><p>　　相信大家都听说过<code>DrawerLayout</code>控件（如果未听过那请去搜索），它是<code>v4</code>库中提供的一个侧滑菜单控件。</p>
<p>　　本节将介绍如何让<code>DrawerLayout</code>和<code>Toolbar</code>配合使用。</p>
<p><br>　　范例1：添加Gradle依赖。<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:appcompat-v7:23.1.1'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  由于Toolbar被放到了appcompat-v7库中，所以我们需要先引用该库。
-  由于appcompat-v7库需要依赖v4库，所以AS也会默认把v4导入进项目中，因此上面只需要加一个v7引用即可。
</code></pre><p><br>　　本质上看，<code>DrawerLayout</code>的作用就是，为我们的界面加上左右两个滑动菜单，因此它由三个部分组成：</p>
<pre><code>-  主布局
-  左侧滑动菜单
-  右侧滑动菜单。
</code></pre><p><br>　　范例2：布局文件。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/mToolbar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"?attr/colorPrimary"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/drawer"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:onClick</span>=<span class="string">"onClick"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"中间的按钮"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/left"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"220dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">"start"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"@android:color/white"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"左侧的按钮"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/right"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"220dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">"end"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"@android:color/white"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"右侧的按钮"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  DrawerLayout标签内部最多支持3个子View（但也可以不设置第三个子View）：
  -  第一个子View表示界面的主布局，会一直显示出来。
  -  第二个子View表示界面左侧的菜单，需要滑动才能显示出来。
  -  第三个子View表示界面右侧的菜单，需要滑动才能显示出来。
-  我们把第二、第三个子View称为抽屉View，抽屉View必须要使用android:layout_gravity属性来指定滑动方向：
   -  start表示当前抽屉View显示在左侧。
   -  end表示当前抽屉View显示在右侧。
-  抽屉View的宽度最好不要超过320dp，这样可以让用户总能看到内容视图的一部分。
</code></pre><p><br>　　范例3：Activity代码。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DrawerLayout drawer;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置Toolbar的标题。</span></span><br><span class="line">        Toolbar toolbar = (Toolbar) findViewById(R.id.mToolbar);</span><br><span class="line">        toolbar.setTitle(<span class="string">"绳命是乳次的灰黄"</span>);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line"></span><br><span class="line">        drawer = (DrawerLayout) findViewById(R.id.drawer);</span><br><span class="line">        <span class="comment">// ActionBarDrawerToggle用来监听DrawerLayout的打开与关闭状态。</span></span><br><span class="line">        ActionBarDrawerToggle mDrawerToggle = <span class="keyword">new</span> ActionBarDrawerToggle(<span class="keyword">this</span>, </span><br><span class="line">            drawer, toolbar, R.string.app_name, R.string.app_name);</span><br><span class="line">        <span class="comment">// 设置让ActionBarDrawerToggle的开关状态随着DrawerLayout的开关状态而改变。</span></span><br><span class="line">        mDrawerToggle.syncState();</span><br><span class="line">        <span class="comment">// 将监听器设置到DrawerLayout中。</span></span><br><span class="line">        drawer.setDrawerListener(mDrawerToggle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 通过代码的方式打开左侧的滑动菜单。</span></span><br><span class="line">        drawer.openDrawer(Gravity.LEFT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = item.getItemId();</span><br><span class="line">        <span class="keyword">if</span> (id == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  需要注意的是，本范例使用的ActionBarDrawerToggle是v7包中的那个。
</code></pre><p><br>　　此时此刻任何语言都是苍白的，点击<a href="http://download.csdn.net/detail/github_28554183/9439065" target="_blank" rel="noopener"> 下载源码 </a>（里面也包含apk），安装运行之后，你就能知道什么效果了。</p>
<center><br><img src="/img/android/android_o03_01.jpg" alt="运行效果图"><br></center>

<p><br>　　上图左上角的那个箭头是带动画的，当抽屉View展开时显示一个箭头，抽屉View关闭是显示三条线。<br><br>　　最后，若想让<code>DrawerLayout</code>在展开时将<code>Toolbar</code>给盖住，只需要将布局文件里的<code>Toolbar</code>移动到<code>DrawerLayout</code>中即可。</p>
<h1 id="第三节-Android-5-0"><a href="#第三节-Android-5-0" class="headerlink" title="第三节 Android 5.0"></a>第三节 Android 5.0</h1><p>　　<code>Android 5.0</code>（Lollipop）是<code>Google</code>于<code>2014/10/15</code>日（美国太平洋时间）发布的全新<code>Android</code>操作系统。<br>　　它是迄今为止规模最大、最为雄心勃勃的<code>Android</code>版本，它不仅为用户推出了各种崭新的新功能，为开发者则提供了数千个新的API，还将<code>Android</code>的疆土扩展得更远，小到手机、平板电脑和穿戴式设备，大到电视和汽车，都可以是它活跃的领地。</p>
<p>　　要深入了解面向开发者的新<code>API</code>，请参阅<a href="http://developer.android.com/intl/zh-cn/about/versions/android-5.0.html" target="_blank" rel="noopener"> Android 5.0 API </a>概述，本章只会介绍一些<code>Android5.0</code>中已经被广泛使用的技术。</p>
<p>　　<code>Android 5.0</code>将<code>Material design</code>设计引入<code>Android</code>系统，您可以借助<code>Material design</code>设计创建应用，使其呈现动态的视觉效果并为用户提供自然的界面元素过渡效果。此支持包括：</p>
<pre><code>-  素材主题背景
-  视图阴影
-  RecyclerView 小部件
-  可绘制的动画和样式效果
-  Material Design 设计动画和活动过渡效果
-  基于视图状态的视图属性动画生成器
-  可自定义的界面小部件和应用栏（含您可以控制的调色板）
-  基于 XML 矢量图形的动画和非动画图形内容
</code></pre><p>　　要详细了解如何向您的应用添加<code>Material Design</code>设计功能，请参阅<a href="http://developer.android.com/intl/zh-cn/training/material/index.html" target="_blank" rel="noopener"> Material Design </a>设计。</p>
<p>　　上面这些文字都是从百度、<code>Google</code>官方文档上复制过来的，说的很抽象，不过没关系，我们接下来将分多个小结依次介绍<code>Android5.0</code>在界面上新增的内容。</p>
<h2 id="CardView"><a href="#CardView" class="headerlink" title="CardView"></a>CardView</h2><p>　　<code>Android5.0</code>中增加了一个全新的控件<code>CardView</code>，它是<code>FrameLayout</code>类的子类，并在<code>FrameLayout</code>基础上添加了<code>圆角</code>和<code>阴影</code>效果。<br>　　也就是说，从此以后我们可以方便的通过代码来实现<code>圆角</code>和<code>阴影</code>的效果，而不再像以前那样依赖于美工做图了（而且给的图不易进行微调）。</p>
<p><br>　　<code>Google</code>已经将<code>CardView</code>放到一个名为<a href="http://developer.android.com/intl/zh-cn/tools/support-library/features.html#v7-cardview" target="_blank" rel="noopener"> v7 cardview library </a>的支持库中了，我们可以在<code>Android2.1</code>之上的任何版本中使用它。在项目中添加对该库的依赖：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:cardview-v7:21.0.0'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br>　　<code>CardView</code>的使用方法十分简单，添加完项目依赖后，直接修改咱们的布局文件即可。</p>
<p><br>　　范例1：<code>activity_main.xml</code>。</p>
<center><br><img src="/img/android/android_o06_01.png" alt="运行效果"><br></center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:card_view</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_margin</span>=<span class="string">"20dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">card_view:cardCornerRadius</span>=<span class="string">"5dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">card_view:cardElevation</span>=<span class="string">"2dp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"HELLO"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v7.widget.CardView</span>&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>语句解释：
-  由于CardView的父类是FrameLayout，因而它的使用方法和FrameLayout是一样的。
-  本范例中定义了android和card_view两个命名空间，CardView所提供的属性都放到了card_view中，也是不多说。
-  属性解释：
   -  cardCornerRadius：设置CardView的圆角半径，值越大圆角就越明显。
   -  cardElevation：设置CardView的阴影高度，值越大阴影就越明显。
   -  cardBackgroundColor：设置CardView的背景色。
   -  contentPadding、contentPaddingLeft、contentPaddingRight、contentPaddingTop、contentPaddingBottom：你懂的。
</code></pre><p><br>　　范例2：显示层级。</p>
<center><br><img src="/img/android/android_o06_02.png" alt="运行在Android5.0设备上的效果"><br></center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:card_view</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"200dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"100dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"20dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">card_view:cardBackgroundColor</span>=<span class="string">"#ff0000"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">card_view:cardCornerRadius</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">card_view:cardElevation</span>=<span class="string">"3dp"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"200dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"100dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">card_view:cardBackgroundColor</span>=<span class="string">"#00ff00"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">card_view:cardCornerRadius</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">card_view:cardElevation</span>=<span class="string">"2dp"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>语句解释：
-  Android5.0中View在绘制的时候增加一个z轴的概念（即显示层级），层级高的View将显示在层级低的View的上面。
-  CardView的cardElevation属性既是用来设置阴影高度，也是用来设置显示层级的，按照以往的情况，由于绿色的CardView是后添加的，因而它会被放到上面显示，但由于它的cardElevation值低，因此最终它被放到了下面去显示。
  -  注意，显示层级是Android5.0提出的，也就是说这段代码只有运行在Android5.0的设备上时，红色的才会盖在绿色上面，否则仍然是绿色在上。
</code></pre><h2 id="RecyclerView"><a href="#RecyclerView" class="headerlink" title="RecyclerView"></a>RecyclerView</h2><p>　　<code>Android5.0</code>中增加了另一个重要的控件就是<code>RecyclerView</code>，它用来取代现有的<code>ListView</code>和<code>GridView</code>控件。</p>
<p><br><strong>问题是这样的</strong></p>
<p>　　在开发中，我们都或多或少的会对<code>ListView</code>的性能有所要求，以便给用户提供流畅的滑动体验，常见的优化方案有如下几个：</p>
<pre><code>-  第一，使用convertView来重用现有的Item。
-  第二，使用ViewHolder来减少findViewById方法的调用次数。
-  第三，尽可能的降低getView方法内对象产生的数量以及大小。如果Item中包含图片那么应该进行异步加载。
</code></pre><p><br>　　而且除了效率上的要求，我们还希望<code>ListView</code>能实现：</p>
<pre><code>-  第一，能实横向、纵向、九宫格、瀑布流等各种布局那就太好了。
-  第二，能在添加和删除每个Item的时候，都播放一个动画那就太好了。
</code></pre><p><br>　　现实的情况是，不论是效率还是功能，<code>ListView</code>都不是最优的，因而<code>Google</code>提出了<code>RecyclerView</code>。</p>
<p><br><strong>是什么、能做什么？</strong><br>　　从类名上看，<code>RecyclerView</code>代表的意义是只管<code>回收和复用View</code>，其他的功能由你自己去完成，给予你充分的定制自由，实现了高度的解耦。在结构上<code>RecyclerView</code>与<code>ListView</code>的区别在于：</p>
<pre><code>-  ListView：
   -  数据由Adapter提供。
   -  Item的创建/重用由ListView来完成。
   -  Item的排列方式（只支持垂直）由ListView来控制。
-  RecyclerView：
   -  数据由Adapter提供。
   -  Item的创建/重用由RecyclerView来完成。
   -  Item的排列方式（垂直、水平、瀑布流等任意方式）由LayoutManager来完成。如果你想自定义自己的排列方式，那么只需要自定义一个LayoutManager类即可。
</code></pre><p><br>　　<code>RecyclerView</code>在提升效率方面上做了如下操作（但不限于）：</p>
<pre><code>-  第一，强制使用ViewHolder。
   -  Android推荐（非强制）LisView使用ViewHolder来减少findViewById()的使用以提高效率。
   -  在RecyclerView中变成了必须使用的模式，Adapter要求返回的值也从普通的View变成了ViewHolder。
-  第二，使用局部更新。
   -  当LisView的数据改变时会更新整个列表，而RecyclerView既支持整体刷新也支持局部刷新（只会更新发生变化的View）。
</code></pre><p>　　同时，<code>RecyclerView</code>在功能方面上已经实现了刚才我们提到的两点：自定义<code>Item</code>排列方式和<code>Item</code>动画。<br><br>　　提示：如果你想阅读各个<code>support</code>库的源码，请点击<a href="https://github.com/android/platform_frameworks_support" target="_blank" rel="noopener"> platform_frameworks_support </a>。</p>
<p><br><strong>开始使用</strong><br>　　同样的<code>Google</code>也已经将<code>RecyclerView</code>放到一个名为<a href="http://developer.android.com/intl/zh-cn/tools/support-library/features.html#v7-recyclerview" target="_blank" rel="noopener"> v7 recyclerview library </a>的支持库中了，我们可以在<code>Android2.1</code>之上的任何版本中使用它。在项目中添加对该库的依赖：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:recyclerview-v7:21.0.0'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br>　　范例1：<code>activity_main.xml</code>。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/my_recycler_view"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><br>　　<code>RecyclerView</code>与<code>AdapterView</code>类似，实现了数据和视图的分离，数据仍然是使用<code>Adapter</code>来提供。<code>RecyclerView</code>的使用步骤为：</p>
<pre><code>-  第一，获取RecyclerView对象。
-  第二，为RecyclerView设置Item的排列方式。
-  第三，为RecyclerView设置Adapter。
</code></pre><p><br>　　范例2：<code>MainActivity</code>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第一，获取RecyclerView对象。</span></span><br><span class="line">        RecyclerView mRecyclerView = (RecyclerView) findViewById(R.id.my_recycler_view);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二，为RecyclerView设置Item的排列方式。下面的代码使用线性布局排列子元素，垂直排列。</span></span><br><span class="line">        LinearLayoutManager mLayoutManager = <span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>);</span><br><span class="line">        mLayoutManager.setOrientation(LinearLayoutManager.VERTICAL);</span><br><span class="line">        mRecyclerView.setLayoutManager(mLayoutManager);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第三，为RecyclerView设置Adapter。</span></span><br><span class="line">        List&lt;String&gt; data = Arrays.asList(<span class="string">"Android"</span>,<span class="string">"ios"</span>,<span class="string">"jack"</span>,<span class="string">"tony"</span>,<span class="string">"window"</span>,<span class="string">"mac"</span>);</span><br><span class="line">        mRecyclerView.setAdapter(<span class="keyword">new</span> MyRecyclerAdapter(data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  系统内置的Item布局方式还有网格（GridView）和瀑布流两种，稍后会介绍它们。
</code></pre><p><br>　　范例3：<code>MyRecyclerAdapter</code>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意：MyRecyclerAdapter的父类是RecyclerView.Adapter类型的。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRecyclerAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">MyRecyclerAdapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; items;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyRecyclerAdapter</span><span class="params">(List&lt;String&gt; items)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items = items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 此方法相当于ListView的getView()方法，当需要返回控件时会调用它。</span></span><br><span class="line">    <span class="comment">// 注意此方法的返回值被强制要求返回RecyclerView.ViewHolder类型的。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">        View v = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_recyclerview, parent, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ViewHolder(v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当需要更新holder所对应的Item中的信息时，会调用此方法。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        String item = items.get(position);</span><br><span class="line">        holder.text.setText(item);</span><br><span class="line">        <span class="comment">// 下面这行代码为了以后能方便通过holder.itemView来获取到这个item对象，下面会介绍holder.itemView是什么。</span></span><br><span class="line">        holder.itemView.setTag(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回适配器中的元素个数。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义ViewHolder类，注意此类我们用static修饰，可以防止ViewHolder持有Adapter的引用。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 和以前一样，ViewHolder将它所管理的每一个控件都作为一个字段，方便外界访问。</span></span><br><span class="line">        <span class="keyword">public</span> TextView text;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// 调用父类的构造方法，在父类中有一个名为itemView字段，专门用来持有参数itemView的引用的，因为父类在后续操作中会用到。</span></span><br><span class="line">            <span class="comment">// 而itemView的子控件的引用，则由当前ViewHolder类的属性来持有，具体请参阅源码。</span></span><br><span class="line">            <span class="keyword">super</span>(itemView);</span><br><span class="line">            <span class="comment">// 从View中获取各个子控件的引用，以减少findViewById方法的调用次数。</span></span><br><span class="line">            text = (TextView) itemView.findViewById(R.id.text);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  如果你没理解holder.itemView的含义，请自行去阅读源码。
</code></pre><p><br>　　范例4：<code>item_recyclerview.xml</code>。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:card_view</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginLeft</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_marginRight</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">card_view:contentPadding</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">card_view:cardCornerRadius</span>=<span class="string">"4dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">card_view:cardElevation</span>=<span class="string">"3dp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/text"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v7.widget.CardView</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  使用了CardView作为根节点，其内部只有一个TextView，用来显示一行文字。
</code></pre><center><br><img src="/img/android/android_o06_03.png" alt="运行效果"><br></center>

<p><br><strong>设置点击事件</strong><br>　　<code>RecyclerView</code>没有提供设置点击事件的方法，我们可以直接在<code>ViewHolder</code>类上添加事件。</p>
<p><br>　　范例1：点击和长按事件。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>, <span class="title">View</span>.<span class="title">OnLongClickListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> TextView text;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(itemView);</span><br><span class="line">        text = (TextView) itemView.findViewById(R.id.text);</span><br><span class="line">        text.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Toast.makeText(v.getContext(),<span class="string">"text click"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 给根View设置点击和长按事件。</span></span><br><span class="line">        itemView.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        itemView.setOnLongClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(v.getContext(),<span class="string">"itemView click"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onLongClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(v.getContext(),<span class="string">"itemView long click"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  直接在构造方法内部给itemVIew设置事件监听器即可。
</code></pre><p><br><strong>Item排列方式</strong></p>
<p><br>　　范例1：网格、瀑布流。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 线性布局排列</span></span><br><span class="line">mRecyclerView.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>, LinearLayoutManager.VERTICAL, <span class="keyword">false</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 网格布局排列</span></span><br><span class="line">mRecyclerView.setLayoutManager(<span class="keyword">new</span> GridLayoutManager(<span class="keyword">this</span>, <span class="number">2</span>, GridLayoutManager.VERTICAL, <span class="keyword">false</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 交错网格布局，类似于网格布局，但每个格子的高度或者长度可以不一样。</span></span><br><span class="line">mRecyclerView.setLayoutManager(<span class="keyword">new</span> StaggeredGridLayoutManager(<span class="number">2</span>, StaggeredGridLayoutManager.VERTICAL));</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  LinearLayoutManager构造方法的三个参数：
   -  context：也是不多说。
   -  orientation：元素排列方向，取值有LinearLayoutManager.VERTICAL和LinearLayoutManager.HORIZONTAL。
   -  reverseLayout：是否反转布局。即元素将从下到上显示，效果参看微信、QQ等软件的聊天界面。
-  GridLayoutManager构造方法的第二个参数：
   -  spanCount：设置每一排上元素的个数。
-  StaggeredGridLayoutManager构造方法的第一个参数也是spanCount，与GridLayoutManager一样。
</code></pre><p><br>　　下图展示了<code>GridLayoutManager</code>（左）和<code>StaggeredGridLayoutManager</code>（右）排列方式的区别：</p>
<center><br><img src="/img/android/android_o06_04.png" alt="运行效果"><br></center>

<p><br><strong>数据更新</strong><br>　　<code>RecyclerView</code>提供了两种数据更新的方式：</p>
<pre><code>-  全部更新：让整个RecyclerView所有正在显示的控件都更新。
   -  调用RecyclerView.Adapter类的notifyDataSetChanged()方法即可。
-  局部更新：如果你往Adapter中“增加、删除、更新”了一个或多个Item，那么就可以调用对应的方法来只刷新这几个Item，从而提升效率。
-  添加：notifyItemInserted(position)、notifyItemRangeInserted(position, itemCount)。
   -  前者告诉RecyclerView，当前往position位置上插入了1个新元素。
   -  后者是从position位置开始，加入了itemCount个元素。
-  删除：notifyItemRemoved(position)、notifyItemRangeRemoved(position, itemCount)。
-  更新：notifyItemChanged(position)、notifyItemChanged(position, itemCount)。
</code></pre><p><br>　　范例1：局部更新。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRecyclerAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">MyRecyclerAdapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; items;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyRecyclerAdapter</span><span class="params">(List&lt;String&gt; items)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.items = items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">        View v = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_recyclerview, parent, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// 注意此处把MyRecyclerAdapter的引用传递了过去。</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ViewHolder(v, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        String item = items.get(position);</span><br><span class="line">        holder.text.setText(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">appendData</span><span class="params">(List&lt;String&gt; newItems)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (newItems != <span class="keyword">null</span> &amp;&amp; newItems.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            items.addAll(newItems);</span><br><span class="line">            notifyItemRangeInserted(items.size()-newItems.size(), newItems.size());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeData</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (position &gt;= <span class="number">0</span> &amp;&amp; position &lt; items.size()) &#123;</span><br><span class="line">            items.remove(position);</span><br><span class="line">            notifyItemRemoved(position);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 弱引用</span></span><br><span class="line">        <span class="keyword">private</span> SoftReference&lt;MyRecyclerAdapter&gt; mAdapter;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> TextView text;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View itemView, MyRecyclerAdapter adapter)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(itemView);</span><br><span class="line">            mAdapter = <span class="keyword">new</span> SoftReference&lt;MyRecyclerAdapter&gt;(adapter);</span><br><span class="line">            text = (TextView) itemView.findViewById(R.id.text);</span><br><span class="line">            itemView.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (mAdapter != <span class="keyword">null</span> &amp;&amp; mAdapter.get() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 调用RecyclerView.ViewHolder类的getPosition()获取当前位置</span></span><br><span class="line">                mAdapter.get().removeData(getPosition());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  如果一个对象被两个地方引用，一个是弱引用，一个是强引用，那么在强引用被释放之前，弱引用会始终有值。
</code></pre><p><br><strong>下拉刷新</strong><br>　　我们也可以很容易的给<code>RecyclerView</code>加上下拉刷新功能。</p>
<p><br>　　范例1：<code>SwipeRefreshLayout</code>。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.SwipeRefreshLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/refreshLayout"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/my_recycler_view"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.SwipeRefreshLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  使用v4包中的SwipeRefreshLayout类将需要下拉刷新的控件包裹一下就可以了。
</code></pre><p><br>　　范例2：设置下拉事件监听器。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> SwipeRefreshLayout mRefreshLayout = (SwipeRefreshLayout) findViewById(R.id.refreshLayout);</span><br><span class="line"><span class="comment">// 调用此方法设置下拉监听器，当用户触发下拉刷新时，会在主线程中回调onRefresh()方法。</span></span><br><span class="line">mRefreshLayout.setOnRefreshListener(<span class="keyword">new</span> SwipeRefreshLayout.OnRefreshListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.5秒后将下拉刷新的状态置为false。</span></span><br><span class="line">        <span class="keyword">new</span> Handler().postDelayed(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                mRefreshLayout.setRefreshing(<span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">1500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  你也可以直接调用setRefreshing(true);来触发下拉刷新的动画，但是不会导致onRefresh方法被调用。
-  下拉刷新的箭头颜色等都是可以修改的。
</code></pre><p><br>　　<a href="http://download.csdn.net/detail/github_28554183/8920585" target="_blank" rel="noopener">点击下载源码 </a></p>
<p>　　如果你没有<code>AndroidStudio</code>环境，可以在<code>MateriaDesign\app\build\outputs\apk</code>目录中找到<code>apk</code>文件。</p>
<p><br><strong>其它特性</strong><br>　　<code>RecyclerView</code>还支持<code>Item分割线</code>、<code>多种Item类型</code>等功能，由于篇幅关系（同时也很容易在网上搜索到答案），笔者暂时就不介绍了。</p>
<p><br><strong>本节参考阅读：</strong></p>
<ul>
<li><a href="http://baike.baidu.com/view/5930831.htm" target="_blank" rel="noopener">百度百科 - Android 5.0</a></li>
<li><a href="http://developer.android.com/intl/zh-cn/about/versions/lollipop.html" target="_blank" rel="noopener">Android Lollipop</a></li>
<li><a href="http://blog.iderzheng.com/first-date-with-recyclerview/" target="_blank" rel="noopener">RecyclerView体验简介</a></li>
</ul>
<h2 id="Design支持库"><a href="#Design支持库" class="headerlink" title="Design支持库"></a>Design支持库</h2><p>　　<code>Android5.0</code>是有史以来最重要的安卓版本之一，这其中有很大部分要归功于material design的引入，这种新的设计让整个安卓的用户体验焕然一新。谷歌在<code>2015 I/O</code>大会时，宣布了一个名叫<code>Design</code>的支持库，在这个库里提供了一堆material design控件。</p>
<p>　　接下来我们就一起来看看它们到底是何方神圣。</p>
<p>　　首先要知道的是，我们可以在<code>Android2.1</code>之上的任何版本中使用<code>Design</code>库，只需要在项目中添加对该库的依赖：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:design:22.2.0'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h3 id="NavigationView"><a href="#NavigationView" class="headerlink" title="NavigationView"></a>NavigationView</h3><p>　　在本章的第二节已经介绍了<code>DrawerLayout</code>是由三部分的组成的，可以用它来创建两个滑动菜单。</p>
<p>　　简单的说，<code>NavigationView</code>就是一个Google帮我们好的滑动菜单控件，它的外表大致为：</p>
<center><br><img src="/img/android/android_o03_02.jpg" alt="知乎客户端"><br></center>

<p>　　从上图可以看出来，<code>NavigationView</code>分为上下两部分：</p>
<pre><code>-  上面的蓝色部分被称为是headerLayout，它可以放任意的控件。
-  下面的白色部分是一组功能按钮，通常是单选的，某一时刻只能有一个被选中。
</code></pre><p><br>　　下面就来介绍如何让<code>Toolbar</code>、<code>DrawerLayout</code>和<code>NavigationView</code>三者配合使用。<br><br>　　范例1：首先在主题下面添加如下两个属性。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimary"</span>&gt;</span>#2196F3<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimaryDark"</span>&gt;</span>#1976D2<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppThemeBase"</span> <span class="attr">parent</span>=<span class="string">"AppTheme"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  AppTheme主题下的两个属性分别用来设置状态栏和标题栏的背景色。
-  然后在清单文件中，直接让Activity或者Application使用AppThemeBase主题即可。
</code></pre><p><br>　　范例2：布局文件。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/drawer"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/mToolbar"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"?attr/colorPrimary"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.NavigationView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/navigation"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"start"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:headerLayout</span>=<span class="string">"@layout/drawer_header"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:menu</span>=<span class="string">"@menu/drawer"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  根节点是DrawerLayout，内容布局是LinearLayout，左侧滑动菜单是NavigationView。
-  NavigationView的headerLayout属性用来设置顶部的布局。
-  NavigationView的menu属性用来指定菜单文件。这个属性几乎是必选的，不然NavigationView控件就失去意义了（我们用NavigationView就是为了导航的，结果却不为它设置导航菜单？）。
   -  另外，也可以在运行时动态改变menu属性。
</code></pre><p><br>　　范例3：headerLayout。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"192dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"?attr/colorPrimaryDark"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">"16dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">"@style/ThemeOverlay.AppCompat.Dark"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"bottom"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Username"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textAppearance</span>=<span class="string">"@style/TextAppearance.AppCompat.Body1"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  这个布局可以任意写，上面的代码是我copy网上的。
</code></pre><p><br>　　范例4：菜单文件。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span> <span class="attr">android:checkableBehavior</span>=<span class="string">"single"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/nav_home"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:checked</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_dashboard"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:title</span>=<span class="string">"Home"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/nav_messages"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_event"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:title</span>=<span class="string">"Messages"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/nav_friends"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_headset"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:title</span>=<span class="string">"Friends"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/nav_discussion"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_forum"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:title</span>=<span class="string">"Discussion"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">"Sub items"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">menu</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_dashboard"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:title</span>=<span class="string">"Sub item 1"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:icon</span>=<span class="string">"@drawable/ic_forum"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:title</span>=<span class="string">"Sub item 2"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  每个菜单项使用item标签来表示，菜单项可以设置标题和图标。
-  上面使用group标签来定义一个菜单组，组内的菜单同一时间只能有一个被选中，且默认选择第一个。
-  菜单是可以嵌套的，嵌套时会将菜单的名字显示出来，同时自动出现一个分割线，具体效果请自行写代码体验。
</code></pre><p><br>　　范例5：Activity代码。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化Toolbar</span></span><br><span class="line">        Toolbar toolbar = (Toolbar) findViewById(R.id.mToolbar);</span><br><span class="line">        toolbar.setTitle(<span class="string">"张德彪"</span>);</span><br><span class="line">        <span class="comment">// 将overflow按钮的颜色改为白色，这个用法是蒙出来的。</span></span><br><span class="line">        toolbar.getOverflowIcon().setColorFilter(Color.WHITE, PorterDuff.Mode.DST);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">        toolbar.setTitleTextColor(Color.WHITE);</span><br><span class="line">        toolbar.setNavigationIcon(R.drawable.ic_menu);</span><br><span class="line">        toolbar.setNavigationOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 用户点击标题栏左侧的按钮时，直接打开左侧的滑动菜单。</span></span><br><span class="line">                drawer.openDrawer(Gravity.LEFT);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化NavigationView</span></span><br><span class="line">        NavigationView navigationView = (NavigationView) findViewById(R.id.navigation);</span><br><span class="line">        <span class="comment">// 设置菜单的点击事件。</span></span><br><span class="line">        navigationView.setNavigationItemSelectedListener(</span><br><span class="line">                <span class="keyword">new</span> NavigationView.OnNavigationItemSelectedListener() &#123;</span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onNavigationItemSelected</span><span class="params">(MenuItem menuItem)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">// 当菜单被点击时，就将它设置为选中状态。</span></span><br><span class="line">                        menuItem.setChecked(<span class="keyword">true</span>);</span><br><span class="line">                        <span class="comment">// 关闭滑动菜单。</span></span><br><span class="line">                        drawer.closeDrawers();</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = item.getItemId();</span><br><span class="line">        <span class="keyword">if</span> (id == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  注意：如果你运行项目的时候发现NavigationView里的菜单看不见了，那应该是你在AppTheme主题下为textColorPrimary和textColorSecondary属性设置值了。
</code></pre><p><br>　　<strong>针对Android 5.0及以上版本</strong></p>
<p>　　运行上面的代码时，仔细观察状态栏的背景色，会发现状态栏的颜色和<code>NavigationView</code>的颜色重叠了（下面的左图）：</p>
<center><br><img src="/img/android/android_o03_03.jpg" alt=""><br></center>

<p>　　我们可以通过配置，让程序变成上面右图的效果，即让状态栏的颜色透明。</p>
<p><br>　　第一步，创建<code>res\values-v21\styles.xml</code>，并加入如下代码：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppThemeBase"</span> <span class="attr">parent</span>=<span class="string">"AppTheme"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowDrawsSystemBarBackgrounds"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:statusBarColor"</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><br>　　第二步，修改布局文件，给<code>DrawerLayout</code>加上如下属性：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:fitsSystemWindows="true"</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  这个属性用来告诉系统由将DrawerLayout来接管状态栏的背景的绘制工作。
</code></pre><p><br>　　最后，<a href="http://download.csdn.net/detail/github_28554183/9440751" target="_blank" rel="noopener">点击此处下载源码 </a>（里面也包含apk），安装运行之后，就能体验<code>NavigationView</code>了。<br><br>　　另外，笔者认为知乎的Android端并没有使用<code>NavigationView</code>，而是自己实现的一个类似的布局。</p>
<p><br></p>
<h3 id="TextInputLayout"><a href="#TextInputLayout" class="headerlink" title="TextInputLayout"></a>TextInputLayout</h3><p>　　在以前，<code>EditText</code>中的<code>hint</code>属性会在用户点击文本框，准备输入内容的时候就消失。</p>
<p>　　这就会导致下面这样的问题：</p>
<pre><code>假设一个页面有多个EditView，很有可能用户在输入多个EditView之后，不知道当前EditView需要输入什么内容。
</code></pre><p>　　<code>TextInputLayout</code>用来包裹<code>EditText</code>对象，当<code>EditText</code>获取输入焦点时，它会自动将<code>hint</code>移动到<code>EditText</code>上方显示。<br>　　另外，当用户输入的内容不合法时，<code>TextInputLayout</code>还可以在文本框的底部，显示一条错误信息。</p>
<p>　　笔者推荐大家去阅读：<a href="http://www.jcodecraeer.com/a/basictutorial/2015/0821/3338.html" target="_blank" rel="noopener">《使用TextInputLayout创建一个登陆界面》</a>，写的很详细。</p>
<p><br></p>
<h3 id="Snackbar"><a href="#Snackbar" class="headerlink" title="Snackbar"></a>Snackbar</h3><p>　　<code>Snackbar</code>提供了一个介于<code>Toast</code>和<code>Dialog</code>之间的轻量级控件，它可以很方便的显示消息和处理点击事件。</p>
<p><br>　　范例1：显示Snackbar。</p>
<center><br><img src="/img/android/android_o03_04.jpg" alt="Snackbar显示效果"><br></center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Snackbar snackbar = Snackbar.make(view,<span class="string">"这是一条Snackbar消息"</span>, Snackbar.LENGTH_LONG);</span><br><span class="line"><span class="comment">// 当用户点击“关闭”二字的时候，就把Snackbar给关掉。</span></span><br><span class="line">snackbar.setAction(<span class="string">"关闭"</span>,<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        snackbar.dismiss();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">snackbar.show();</span><br></pre></td></tr></table></figure>
<pre><code>语句解释：
-  Snackbar的使用方法和Toast类似，其中view可以取值为当前界面上的任何一个View。
</code></pre><p><br>　　范例2：修改字体的颜色。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Snackbar snackbar = Snackbar.make(view,</span><br><span class="line">        Html.fromHtml(<span class="string">"&lt;font color='green'&gt;这是一条Snackbar消息&lt;/font&gt;"</span>), Snackbar.LENGTH_LONG);</span><br><span class="line"><span class="comment">// 设置action文本的字体颜色。</span></span><br><span class="line">snackbar.setActionTextColor(Color.RED);</span><br><span class="line">snackbar.setAction(<span class="string">"关闭"</span>,<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        snackbar.dismiss();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">snackbar.show();</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  笔者想说的是，既然Snackbar并没有提供直接修改消息字体颜色的方法，那就表明不希望我们修改，它会帮我们处理各个系统之间的差异。
-  如果实在是想修改，则可以使用Html类，因为Snackbar可以显示一个CharSequence类型的文本。
</code></pre><p><br>　　<code>Toast</code>和<code>SnackBar</code>的区别是，前者是悬浮在所有布局之上的包括软键盘，后者则是显示在当前界面的View树上的。</p>
<p><br>　　这一点从的源码上可以看出来：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ViewGroup <span class="title">findSuitableParent</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">    ViewGroup fallback = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (view <span class="keyword">instanceof</span> CoordinatorLayout) &#123;</span><br><span class="line">            <span class="comment">// We've found a CoordinatorLayout, use it</span></span><br><span class="line">            <span class="keyword">return</span> (ViewGroup) view;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (view <span class="keyword">instanceof</span> FrameLayout) &#123;</span><br><span class="line">            <span class="keyword">if</span> (view.getId() == android.R.id.content) &#123;</span><br><span class="line">                <span class="comment">// If we've hit the decor content view, then we didn't find a CoL in the</span></span><br><span class="line">                <span class="comment">// hierarchy, so use it.</span></span><br><span class="line">                <span class="keyword">return</span> (ViewGroup) view;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// It's not the content view but we'll use it as our fallback</span></span><br><span class="line">                fallback = (ViewGroup) view;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Else, we will loop and crawl up the view hierarchy and try to find a parent</span></span><br><span class="line">            <span class="keyword">final</span> ViewParent parent = view.getParent();</span><br><span class="line">            view = parent <span class="keyword">instanceof</span> View ? (View) parent : <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (view != <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If we reach here then we didn't find a CoL or a suitable content view so we'll fallback</span></span><br><span class="line">    <span class="keyword">return</span> fallback;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  这段代码主要的作用是，从我们传递给Snackbar的View开始往上找，直到找到CoordinatorLayout或FrameLayout，然后Snackbar将被显示到找到的布局里。
-  也就是说：
   -  如果界面中有CoordinatorLayout或android.R.id.content对象，则Snackbar会被直接放进去。
   -  如果界面中没有找到这两者中的任何一个，则Snackbar会被放到最后找到的（也就是最外层的）FrameLayout中去。
   -  因此网上有人说不要传递给Snackbar一个ScrollView对象的说法不完全成立，因为若你的布局中有android.R.id.content，则就不用担心。
</code></pre><p><br>　　另外，有哥们在<a href="http://blog.csdn.net/jywangkeep_/article/details/46405301" target="_blank" rel="noopener">《Snackbar使用及其注意事项》</a>中说多次弹出Snackbar会让内存不足：</p>
<pre><code>-  笔者认为这个问题完全不用担心，就算可用内存变成0了，这都没关系，只要Snackbar不存在内存泄漏就行。
-  因为当系统需要分配新内存且检测到内存不足时，就会自动触发gc，这样就会瞬间把之前的Snackbar占据的内存给回收回来。
-  不信你可以写个demo，在真机上运行看看，当可用内存为0的时候，是不是瞬间就还原了。
</code></pre><p><br></p>
<h3 id="TabLayout"><a href="#TabLayout" class="headerlink" title="TabLayout"></a>TabLayout</h3><p>　　<code>TabLayout</code>用来实现<code>Tabs</code>选项卡界面，效果类似网易新闻客户端的Tab。</p>
<center><br><img src="http://www.jcodecraeer.com/uploads/20150731/1438306976405961.gif" alt="TabLayout显示效果"><br></center>

<p>　　其实在<code>Github</code>上有很多开源库可以实现这个效果，只是谷歌把它官方化了，使得开发者无需引用第三方库就能使用。</p>
<p>　　它的用法网上有很多教程，笔者在这里简单说一下它的特点：</p>
<pre><code>-  支持Tab页滚动。
-  支持和ViewPager连动。
-  支持各种基础操作：事件监听、动态增删Tab等等。
</code></pre><p>　　更多的细节不打算细说，推荐阅读：<a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0731/3247.html" target="_blank" rel="noopener">《android design library提供的TabLayout的用法》</a>。</p>
<p><br></p>
<h3 id="FloatingActionButton"><a href="#FloatingActionButton" class="headerlink" title="FloatingActionButton"></a>FloatingActionButton</h3><p>　　顾名思义，<code>FloatingActionButton</code>是一个浮动按钮，它的特点就是可以浮动显示在其它控件之上。</p>
<p><br>　　从源码上可以看出，它本质上就是一个按钮：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FloatingActionButton</span> <span class="keyword">extends</span> <span class="title">ImageButton</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 省略若干行代码...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  FloatingActionButton继承自我们早就知道的ImageButton类。
</code></pre><p><br>　　范例1：使用FloatingActionButton。</p>
<center><br><img src="/img/android/android_o03_05.jpg" alt="程序运行效果"><br></center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/drawer"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">"10dp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.FloatingActionButton</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@mipmap/ic_launcher"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:fabSize</span>=<span class="string">"mini"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.FloatingActionButton</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/ic_done"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:elevation</span>=<span class="string">"1dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:backgroundTint</span>=<span class="string">"#000af4"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:fabSize</span>=<span class="string">"normal"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>语句解释：
-  src属性，设置按钮所显示的图片。
-  fabSize属性，设置按钮的尺寸，有mini(小尺寸)和normal(正常尺寸)两个取值。
-  elevation属性，设置按钮的阴影高度。
-  backgroundTint属性，设置按钮的背景色。
-  layout_anchor属性，为浮动按钮指出它要浮动在哪个View上，取值是View的id。
-  layout_anchorGravity属性，设置浮动按钮在View上的位置。
</code></pre><p><br>　　需要说明的是，<code>FloatingActionButton</code>需要和配合<code>CoordinatorLayout</code>使用才能发挥它真正的威力，下面就来介绍它。</p>
<p><br></p>
<h3 id="CoordinatorLayout"><a href="#CoordinatorLayout" class="headerlink" title="CoordinatorLayout"></a>CoordinatorLayout</h3><p>　　<code>Coordinator</code>中文翻译为协调者、协调器，也就是说它本身不会在屏幕上显示内容，而是做为其它控件的协调器。<br>　　<br>　　这一点从的源码上可以看出来：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CoordinatorLayout</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> <span class="keyword">implements</span> <span class="title">NestedScrollingParent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 省略若干行代码...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  之前我们说过，默认情况下ViewGroup是不绘制任何内容的。
</code></pre><p><br>　　范例1：放置控件。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"left|bottom"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"onClick"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Button1"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"right|top"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Button2"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  CoordinatorLayout的子元素需要使用layout_gravity属性来设置自己的位置。
   -  水平方向的取值有：start、end、left、right等。
   -  垂直方向的取值有：top、bottom等。
-  另外，CoordinatorLayout对Snackbar做了增强：
   -  当Snackbar被放到CoordinatorLayout中显示时，那么在Snackbar自动关闭之前，用户还可以手动滑动删除它。
</code></pre><p><br>　　范例2：与<code>FloatingActionButton</code>配合使用。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.FloatingActionButton</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/fab"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"end|bottom"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_margin</span>=<span class="string">"16dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:onClick</span>=<span class="string">"onClick"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/ic_done"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  当Snackbar在显示的时候，往往出现在屏幕的底部，若我们把FloatingActionButton也放到屏幕右下角的话，那么当Snackbar弹出时，浮动按钮就会被遮挡。
-  不过CoordinatorLayout专门为做了浮动按钮做了适配，当Snackbar弹出时：
   -  若Snackbar将会遮挡浮动按钮，则就会将浮动按钮向上移动，Snackbar关闭时再移回来。
   -  若不会遮挡浮动按钮，则不移动。
   -  对于其他非浮动按钮控件来说，即便是Snackbar遮挡了它们，它们也不会移动。
</code></pre><p><br>　　事实上，<code>CoordinatorLayout</code>也可以和<code>Toolbar</code>组合在一起实现各种效果。<br>　　但是它们是无法直接配合的，我们需要在它们之间添加一个名为<code>AppBarLayout</code>的控件，该控件是<code>LinearLayout</code>的子类，默认垂直排列元素。</p>
<p>　　也就是说，我们的布局文件的结构最终的应该为：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">CoordinatorLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Toolbar</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">RecyclerView</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  整个配合过程为：
   -  首先，使用CoordinatorLayout来监听RecyclerView、ViewPager等控件的滑动事件。
   -  然后，CoordinatorLayout将它得到的滑动事件交给AppBarLayout。
   -  接着，AppBarLayout来修改Toolbar的状态（显示或隐藏、尺寸等）。
</code></pre><p><br>　　范例3：修改标题栏。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/recycle"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_behavior</span>=<span class="string">"@string/appbar_scrolling_view_behavior"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/appbar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">"@style/ThemeOverlay.AppCompat.Dark.ActionBar"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/toolbar"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"?attr/colorPrimary"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_scrollFlags</span>=<span class="string">"scroll|enterAlways"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:popupTheme</span>=<span class="string">"@style/ThemeOverlay.AppCompat.Light"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 你可以在此处添加一个Button控件，但是不为它设置layout_scrollFlags属性，然后观察效果。--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 正确的效果应该是，Toolbar会随着滚动而显示或隐藏，而Button会一直显示。--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 因此比较常见的做法是，会在这里加一个TabLayout，这样就可以保证Tab总会显示了。--&gt;</span></span><br><span class="line">             </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  首先，RecyclerView和AppBarLayout定义的位置无所谓，CoordinatorLayout会自动让标题栏显示在上方。
-  然后，第11行代码用来让CoordinatorLayout来监听RecyclerView的滑动事件。
-  接着要知道的是，AppBarLayout内部可以包含多个控件，因此当AppBarLayout接到CoordinatorLayout的事件后，会遍历所有子控件并进行判断：
   -  若当前子控件愿意接收滑动事件，则进行后续处理。
   -  若不愿接收，则跳过该子控件，继续检查下一个。
-  也就是说，子控件使用layout_scrollFlags属性来告诉AppBarLayout它愿意接收事件，以及当事件发生时它希望的处理方式。
   -  如果愿意接收滑动事件，则取值中必须得包含scroll关键字。
   -  多个取值之间使用‘|’符号间隔。
-  layout_scrollFlags属性的常用取值：
   -  enterAlways：不论RecyclerView当前滚动到何处，只要它向下滑动就隐藏标题栏，向上滚动就显示标题栏。
   -  enterAlwaysCollapsed：只有RecyclerView滚动到顶部时，才会显示和隐藏标题栏。
   -  exitUntilCollapsed：稍后介绍。
</code></pre><p><br>　　我们还可以让<code>Toolbar</code>实现折叠效果，只需要使用<code>CollapsingToolbarLayout</code>包裹<code>Toolbar</code>即可。</p>
<p><br>　　范例4：折叠标题栏。</p>
<center><br><img src="http://www.jcodecraeer.com/uploads/allimg/150717/1G0543025-1.gif" alt="程序运行效果"><br></center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/recycle"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_behavior</span>=<span class="string">"@string/appbar_scrolling_view_behavior"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/appbar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"192dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">"@style/ThemeOverlay.AppCompat.Dark.ActionBar"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.design.widget.CollapsingToolbarLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:contentScrim</span>=<span class="string">"?attr/colorPrimary"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_scrollFlags</span>=<span class="string">"scroll|exitUntilCollapsed"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/toolbar"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"?attr/colorPrimary"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_collapseMode</span>=<span class="string">"pin"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:popupTheme</span>=<span class="string">"@style/ThemeOverlay.AppCompat.Light"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">android.support.design.widget.CollapsingToolbarLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>语句解释：
-  必须得为AppBarLayout显式的指定高度，Toolbar的高度不能是wrap_content，而需要是具体的数值。
-  需要为Toolbar设置layout_collapseMode属性，且值为pin。
-  contentScrim属性，ToolBar被折叠到顶部固定时候的背景。
-  layout_collapseMode属性，设置折叠的方式，有两个取值：
   -  pin：固定模式，在折叠的时候最后固定在顶端，效果如上图所示。
   -  parallax：视差模式，在折叠的时候会有个视差折叠的效果，效果如下图所示。
</code></pre><p><br>　　范例5：视差滚动。</p>
<center><br><img src="http://www.jcodecraeer.com/uploads/allimg/150717/1G0541510-7.gif" alt="程序运行效果"><br></center>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/recycle"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_behavior</span>=<span class="string">"@string/appbar_scrolling_view_behavior"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/appbar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"192dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">"@style/ThemeOverlay.AppCompat.Dark.ActionBar"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.design.widget.CollapsingToolbarLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/collapsing_toolbar"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_scrollFlags</span>=<span class="string">"scroll|exitUntilCollapsed"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:fitsSystemWindows</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:contentScrim</span>=<span class="string">"?attr/colorPrimary"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:expandedTitleMarginStart</span>=<span class="string">"48dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:expandedTitleMarginEnd</span>=<span class="string">"64dp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/backdrop"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:src</span>=<span class="string">"@drawable/cheese_1"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:fitsSystemWindows</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_collapseMode</span>=<span class="string">"parallax"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/toolbar"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:popupTheme</span>=<span class="string">"@style/ThemeOverlay.AppCompat.Light"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_collapseMode</span>=<span class="string">"pin"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">android.support.design.widget.CollapsingToolbarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.FloatingActionButton</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/ic_done"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_anchor</span>=<span class="string">"@id/appbar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_anchorGravity</span>=<span class="string">"bottom|right|end"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<pre><code>语句解释：
-  使用layout_anchorGravity和layout_anchor属性可以让FloatingActionButton可以跟着AppBarLayout一起消失。
</code></pre><p><br><strong>本节参考阅读：</strong></p>
<ul>
<li><a href="http://android-developers.blogspot.hk/2015/05/android-design-support-library.html" target="_blank" rel="noopener">官方博客：Android Design Support Library</a></li>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/developer/2015/0531/2958.html" target="_blank" rel="noopener">中文翻译：Android的材料设计兼容库</a></li>
<li><a href="http://myihsan.farbox.com/post/use-navigation-view-to-make-navigation-drawer" target="_blank" rel="noopener">通过 Navigation View 创建导航抽屉</a></li>
<li><a href="http://www.cnblogs.com/wingyip/p/4604461.html" target="_blank" rel="noopener">Android SnackBar</a></li>
<li><a href="http://blog.csdn.net/feiduclear_up/article/details/46514791" target="_blank" rel="noopener">Android M新控件之AppBarLayout，NavigationView，CoordinatorLayout，CollapsingToolbarLayout的使用</a></li>
<li><a href="https://www.aswifter.com/2015/06/21/andorid-material-design-support-library/" target="_blank" rel="noopener">探索新的Android Material Design支持库</a></li>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0717/3196.html" target="_blank" rel="noopener">CoordinatorLayout与滚动的处理</a></li>
<li><a href="http://blog.csdn.net/xyz_lmn/article/details/48055919" target="_blank" rel="noopener">android CoordinatorLayout使用</a></li>
</ul>
<p><br><br></p>

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
        </div>
      

      
      
    </footer>
  </article>


  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="android-total-003/"
           data-title="综合篇 第三章 Android Support Library" data-url="http://yoursite.com/android-total-003/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="乐信圣文" />
          <p class="site-author-name" itemprop="name">乐信圣文</p>
          <p class="site-description motion-element" itemprop="description">集大家之成，悟小家之道。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">49</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="http://www.gov.cn/" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#第一节-概述"><span class="nav-number">1.</span> <span class="nav-text">第一节 概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#V4-支持库"><span class="nav-number">1.1.</span> <span class="nav-text">V4 支持库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#V7-支持库"><span class="nav-number">1.2.</span> <span class="nav-text">V7 支持库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#V8-支持库"><span class="nav-number">1.3.</span> <span class="nav-text">V8 支持库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#V13-支持库"><span class="nav-number">1.4.</span> <span class="nav-text">V13 支持库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Multidex-支持库"><span class="nav-number">1.5.</span> <span class="nav-text">Multidex 支持库</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第二节-ActionBar-和-Toolbar"><span class="nav-number">2.</span> <span class="nav-text">第二节 ActionBar 和 Toolbar</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ActionBar"><span class="nav-number">2.1.</span> <span class="nav-text">ActionBar</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#图标和标题"><span class="nav-number">2.1.1.</span> <span class="nav-text">图标和标题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ActionButton"><span class="nav-number">2.1.2.</span> <span class="nav-text">ActionButton</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义布局"><span class="nav-number">2.1.3.</span> <span class="nav-text">自定义布局</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Toolbar"><span class="nav-number">2.2.</span> <span class="nav-text">Toolbar</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第二节-DrawerLayout"><span class="nav-number">3.</span> <span class="nav-text">第二节 DrawerLayout</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第三节-Android-5-0"><span class="nav-number">4.</span> <span class="nav-text">第三节 Android 5.0</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CardView"><span class="nav-number">4.1.</span> <span class="nav-text">CardView</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RecyclerView"><span class="nav-number">4.2.</span> <span class="nav-text">RecyclerView</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Design支持库"><span class="nav-number">4.3.</span> <span class="nav-text">Design支持库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#NavigationView"><span class="nav-number">4.3.1.</span> <span class="nav-text">NavigationView</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TextInputLayout"><span class="nav-number">4.3.2.</span> <span class="nav-text">TextInputLayout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Snackbar"><span class="nav-number">4.3.3.</span> <span class="nav-text">Snackbar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TabLayout"><span class="nav-number">4.3.4.</span> <span class="nav-text">TabLayout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FloatingActionButton"><span class="nav-number">4.3.5.</span> <span class="nav-text">FloatingActionButton</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CoordinatorLayout"><span class="nav-number">4.3.6.</span> <span class="nav-text">CoordinatorLayout</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">乐信圣文</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"cutler"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("sGcgYofeKOFi2l1XvGrm0PcP-gzGzoHsz", "Sx0mWxj4pkXYm17zT0UnV5Ca");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
