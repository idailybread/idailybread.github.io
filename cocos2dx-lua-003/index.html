<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="http://www.gov.cn/" title="乐信圣文" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="经过前两章的学习我们已经做好了充足的准备，那么接下来我们就开始吧。 第一节 基础概念　　  为了全面掌握游戏开发，我们首先需要了解该引擎的几个基本概念。实际上这些基本概念是所有游戏开发所必须的，并非Cocos2d-x专有。任何游戏都是通过这些概念所针对的对象组建起来的，游戏的复杂程度决定了这些对象实现的复杂程度。 游戏组成导演（Diretor）　　  一款游戏好比一部电影，只是游戏具有更强的交">
<meta property="og:type" content="article">
<meta property="og:title" content="Cocos2dx - Lua篇 第三章 环境搭建">
<meta property="og:url" content="http://yoursite.com/cocos2dx-lua-003/index.html">
<meta property="og:site_name" content="乐信圣文">
<meta property="og:description" content="经过前两章的学习我们已经做好了充足的准备，那么接下来我们就开始吧。 第一节 基础概念　　  为了全面掌握游戏开发，我们首先需要了解该引擎的几个基本概念。实际上这些基本概念是所有游戏开发所必须的，并非Cocos2d-x专有。任何游戏都是通过这些概念所针对的对象组建起来的，游戏的复杂程度决定了这些对象实现的复杂程度。 游戏组成导演（Diretor）　　  一款游戏好比一部电影，只是游戏具有更强的交">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/img/quick-cocos2d-x/quick_3_1.png">
<meta property="og:image" content="http://yoursite.com/img/quick-cocos2d-x/quick_3_2.png">
<meta property="og:image" content="http://yoursite.com/img/quick-cocos2d-x/quick_3_3.jpg">
<meta property="og:image" content="http://yoursite.com/img/quick-cocos2d-x/quick_3_4.png">
<meta property="og:image" content="http://yoursite.com/img/quick-cocos2d-x/quick_3_5.png">
<meta property="og:image" content="http://yoursite.com/img/quick-cocos2d-x/quick_3_6.png">
<meta property="og:image" content="http://yoursite.com/img/quick-cocos2d-x/quick_3_7.jpg">
<meta property="og:updated_time" content="2019-10-21T04:25:31.021Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cocos2dx - Lua篇 第三章 环境搭建">
<meta name="twitter:description" content="经过前两章的学习我们已经做好了充足的准备，那么接下来我们就开始吧。 第一节 基础概念　　  为了全面掌握游戏开发，我们首先需要了解该引擎的几个基本概念。实际上这些基本概念是所有游戏开发所必须的，并非Cocos2d-x专有。任何游戏都是通过这些概念所针对的对象组建起来的，游戏的复杂程度决定了这些对象实现的复杂程度。 游戏组成导演（Diretor）　　  一款游戏好比一部电影，只是游戏具有更强的交">
<meta name="twitter:image" content="http://yoursite.com/img/quick-cocos2d-x/quick_3_1.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/cocos2dx-lua-003/"/>

  <title> Cocos2dx - Lua篇 第三章 环境搭建 | 乐信圣文 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?53b4b0b5aeb5df5e4fb6263a58d8e1a9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">乐信圣文</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-feedback">
          <a href="/feedback" rel="section">
            
            联系我们
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Cocos2dx - Lua篇 第三章 环境搭建
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            
              <span class="post-meta-item-text">Cutler</span>
            
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-12-10T21:52:05+08:00" content="2014-12-10">
              2014-12-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/游戏开发/" itemprop="url" rel="index">
                    <span itemprop="name">游戏开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          

          
          
             <span id="/cocos2dx-lua-003/" class="leancloud_visitors" data-flag-title="Cocos2dx - Lua篇 第三章 环境搭建">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>　　经过前两章的学习我们已经做好了充足的准备，那么接下来我们就开始吧。</p>
<h1 id="第一节-基础概念"><a href="#第一节-基础概念" class="headerlink" title="第一节 基础概念"></a>第一节 基础概念</h1><p>　　  为了全面掌握游戏开发，我们首先需要了解该引擎的几个基本概念。实际上这些基本概念是所有游戏开发所必须的，并非<code>Cocos2d-x</code>专有。任何游戏都是通过这些概念所针对的对象组建起来的，游戏的复杂程度决定了这些对象实现的复杂程度。</p>
<h2 id="游戏组成"><a href="#游戏组成" class="headerlink" title="游戏组成"></a>游戏组成</h2><h3 id="导演（Diretor）"><a href="#导演（Diretor）" class="headerlink" title="导演（Diretor）"></a>导演（Diretor）</h3><p>　　  一款游戏好比一部电影，只是游戏具有更强的交互性，不过它们的基本原理是一致的。所以在<code>Cocos2dx</code>中把统筹游戏大局的类抽象为导演（<code>Director</code>），<code>Director</code>是整个<code>Cocos2dx</code>引擎的核心，是整个游戏的导航仪，游戏中的一些常用操作就是由<code>Director</code>来控制的。<br>　　  导演（<code>Director</code>）常用的功能：</p>
<pre><code>-  OpenGL ES的初始化、游戏暂停继续的控制
-  场景的转换、世界坐标和GL坐标之间的切换
-  游戏数据的保存调用，屏幕尺寸的获取
-  控制FPS的显示隐藏，窗口大小，游戏的进入，退出，获取当前正在运行的场景等等。
</code></pre><p>　　在整个游戏里面，一般只有一个导演，导演来指定游戏规则让游戏内的场景、布景和人物等可以有序的运行。</p>
<p><br>　　我们假设一个只有两关的游戏，通常情况下，我们会返样设计整个游戏的流程（workflow）：</p>
<center><br><img src="/img/quick-cocos2d-x/quick_3_1.png" alt="游戏流程"><br></center>

<p>　　显示完开场动画之后，接下来玩家的选择有多种，无论开始还是读取进度都会进入到游戏的预设关卡。游戏过程中第一关胜利则进入第二关，第二关胜利则进入结尾胜利画面（播放视频或者在背景图上显示文字），确认以后进入排名画面看看本次得了多少分。有一个统一的画面处理失败提示，确定后跳转到主画面重新开始。</p>
<p>　　从开场动画到菜单显示，再到各个关卡的切换，这一切的流程都是由导演来控制的。<br><br></p>
<h3 id="场景（Scene）"><a href="#场景（Scene）" class="headerlink" title="场景（Scene）"></a>场景（Scene）</h3><p>　　从上面的描述中我们可以知道，玩家玩游戏的过程就是在我们预设的画面之间进行跳转，一个画面根据玩家操作的结果（选择菜单项、杀死或被敌人消灭）跳转到不同的画面。</p>
<p>　　这些构成整个游戏的流程的画面就是我们所说的场景（<code>Scene</code>）。显然不同的场景都提供不同的操作，大致可以分为以下几类场景：</p>
<pre><code>-  展示类场景：播放视频或简单的在图像上输出文字，来实现游戏的开场介绍、胜利、失败提示、帮助简介。
-  选项类场景：主菜单、设置游戏参数等。
-  游戏场景：这是游戏的主要内容，除了这个场景之外的其他类场景基本上都是通用架构实现的。
</code></pre><p>　　那么不同的场景是如何实现不同的功能的呢？每个场景都是通过不同的层（<code>Layer</code>）的叠加和组合协作来实现不同的功能的。因此，通常每个场景都是由一个或者几个层组成的。</p>
<p>　　通常，当我们需要完成一个场景时候，会创建一个<code>Scene</code>的子类，并在子类中实现我们需要的功能。比如，我们可以在子类的初始化中载入游戏资源，为场景添加层，启动音乐播放等等。<br><br></p>
<h3 id="层（Layer）"><a href="#层（Layer）" class="headerlink" title="层（Layer）"></a>层（Layer）</h3><p>　　每个游戏场景中都可以有很多层，每一层有各自的职责任务，例如专门负责显示背景，专门负责显示道具，专门负责显示任务角色等。层是我们写游戏的重点，我们大约<code>99%</code>以上的时间是在层上实现我们游戏内容。如下图所示，一个简单的主菜单画面是由3个层叠加实现的：</p>
<center><br><img src="/img/quick-cocos2d-x/quick_3_2.png" alt=""><br></center>

<p><br>　　本图描述的是<code>主菜单画面场景</code>中所包含的三个层：图像背景层、运动精灵层、菜单选项层。</p>
<p>　　细心的读者可能已经注意到，为了让不同的层可以组合产生统一的效果，这些层基本上都是透明或者半透明的（否则我们只能看到最上面的一个层了）。<br>　　层的叠加是有顺序的，如图所示：编号为1的图像背景层在最下面，2号中间，3号最上面，处于最上面的层内部的不透明的内容将覆盖下面层的内容。<br>　　这个次序同样用于编程模型中的事件响应机制。即编号3的层最先接收到系统事件（手指单击屏幕事件），然后是编号2，最后编号1。在事件的传递过程中，如果有一个层处理了该事件，则排在后面的层将不再接收到该事件。<br>　　在每一层上面可以放置不同的元素，包括文本（<code>Label</code>）、链接（<code>HTMLLabel</code>）、精灵（<code>Sprite</code>）、地图等等，其中，精灵是重点。<br>　　通过层与层之间的组合关系，我们可以很容易的控制和显示各种各样的界面了。</p>
<p>　　也许你会有疑问：<strong>为什么不把文本、链接、精灵等直接放在场景里却放到层里？ </strong><br>　　事实上<code>Layer</code>是处理玩家事件响应的<code>Node</code>子类。与场景不同，层通常包含的是直接在屏幕上呈现的内容，并且可以接受用户的输入事件，包括触摸，加速度计和键盘输入等。我们需要在层中加入精灵，文本标签或者其他游戏元素，并设置游戏元素的属性，比如位置，方向和大小；设置游戏元素的动作等。通常，层中的对象功能类似，耦合较紧，与层中游戏内容相关的逻辑代码也编写在层中，在组织好层后，只需要把层按照顺序添加到场景中就可以显示出来了。</p>
<p>　　对于场景而言，通常我们添加的节点就是层。先添加的层会被置于后添加的层之下。如果需要为它们指定先后次序，可以使用不同的<code>zOrder</code>值。层可以包含任何Node作为子节点，包括<code>Sprites</code>，<code>Labels</code>，甚至其他的<code>Layer</code>对象。<br><br></p>
<h3 id="精灵（Sprite）"><a href="#精灵（Sprite）" class="headerlink" title="精灵（Sprite）"></a>精灵（Sprite）</h3><p>　　精灵是整个游戏开发处理的主要对象，包括主角和敌人、<code>NPC</code>等，甚至随机飘过的一片云或飞鸟从技术上讲，也是精灵，因为精灵在<code>Cocos2dx</code>中，就是一个可以不断变化的图片，这些变化包括位置变化，旋转、放大缩小和运动等。<br>　　因此所谓游戏，本质上就是玩家操作一个或多个人工控制的精灵与一个或者若干个系统控制的敌方精灵进行互动：近身肉搏、远程射击、贴近对话等等。<br>　　<code>Cocos2dx</code>中的精灵和其他游戏引擎中的精灵相似，它可以移动，旋转，缩放，执行动画，并接受其他转换。</p>
<h2 id="整体结构"><a href="#整体结构" class="headerlink" title="整体结构"></a>整体结构</h2><p>　　到此为止，我们已经大概了解了一个游戏的整体架构，不同的场景由不同的层组成，每个层又包括自己的精灵在层上运动。玩家玩游戏的过程就是在操作每个层上的精灵或者菜单选项，导致整个游戏在不同的场景中切换。<br>　　好了，有些OO编程基础的读者已经猜到导演（<code>Director</code>）对象的作用了。是的，按照面向对象的设计原则和反向依赖原则：精灵不应该依赖层、层不应该依赖场景、场景不应该依赖整个流程。导演对象是整个流程的代表，他负责游戏全过程的场景切换。</p>
<p>　　导演通常只有一个，因此这个对象是单例（<code>singleton</code>），<code>Cocos2d-x</code>框架已经预定义了该实例，我们直接使用就可以。<br>　　导演接受层/场景的要求，按照预先设计好的流程来终止、压栈、激活当前场景，引导下一个场景。至此，我们可以勾勒出一个游戏的整体框架和<code>Cocos2d-x</code>关键对象与之的对应关系：</p>
<center><br><img src="/img/quick-cocos2d-x/quick_3_3.jpg" alt="游戏整体结构"><br></center>

<p>　　需要特别说明的是：任何时间只有一个<code>Scene</code>对象实例处于运行激活状态。该对象可以作为当前游戏内容的对象的整体包容对象。<br>　　以上就是一个游戏的主要整体对象架构。<br>　　实际上，针对每个游戏场景而言，不同场景（关卡）、每一个层（静态、动态）、每一个对象（敌人、我方、中立方）其实都很复杂。</p>
<p>　　万里长征，第一步吧。</p>
<p><strong>备注：</strong><br>　　笔者在此万分感谢新浪博主“知易”写的<a href="http://blog.sina.com.cn/s/articlelist_1400679352_3_1.html" target="_blank" rel="noopener">“知易Cocco2D-iPhone开发教程”</a>，前人为我们铺平了道路，在此向工作在前线的前辈们致敬。</p>
<p><br><strong>本节参考阅读：</strong></p>
<ul>
<li><a href="http://cn.cocos2d-x.org/article/index?type=cocos2d-x&amp;url=/doc/cocos-docs-master/manual/framework/native/v3/basic-concepts/zh.md" target="_blank" rel="noopener">基础概念介绍——导演、场景、层、精灵</a></li>
</ul>
<h2 id="Cocos2d-x-3-0坐标系详解"><a href="#Cocos2d-x-3-0坐标系详解" class="headerlink" title="Cocos2d-x 3.0坐标系详解"></a>Cocos2d-x 3.0坐标系详解</h2><h3 id="坐标系"><a href="#坐标系" class="headerlink" title="坐标系"></a>坐标系</h3><p>　　无论是搞<code>2D</code>(dimension，维)游戏还是<code>3D</code>游戏开发，最需要搞清楚的就是坐标系，这部分混乱的话就没啥奔头了。</p>
<p>　　在介绍坐标系之前，先介绍一下维度的概念。<br>　　维度，又称维数，是数学中独立参数的数目。在物理学和哲学的领域内，指独立的时空坐标的数目。</p>
<pre><code>-  0维是一点，没有长度。
-  1维是线，它由n个连续点组成，线只有长度。如直线、曲线。
-  2维是一个平面，它由n个连续的线组成，平面有长度和宽度，以及面积。如圆形、矩形。
-  3维是2维加上高度，形成“体积面”。如圆柱、长方体。而常说的2D、3D游戏开发，就是指在二维游戏、三维游戏。
</code></pre><p>　　游戏在运行的时候会绘制各种游戏元素(精灵、层等)到屏幕上，这些元素在屏幕上的位置称为该元素的在屏幕中的坐标。<br>　　在<code>2D</code>游戏中坐标由<code>x</code>和<code>y</code>两个值构成，它们分别代表<code>x</code>轴(水平方向)和<code>y</code>轴(垂直方向)相对于原点的偏移量。 如将一个精灵放在屏幕坐标<code>(10,10)</code>上，就是水平和垂直都偏移<code>10</code>个位置。如图所示：</p>
<center><br><img src="/img/quick-cocos2d-x/quick_3_4.png" alt="坐标轴"><br></center>

<p>　　而在<code>3D</code>游戏中的坐标则是由三个值构成。</p>
<p>　　坐标系是数学或物理学用语，定义：对于一个<code>n</code>维系统，能够使每一个点和一组（n个）标量构成一一对应的系统。<br>　　在<code>Cocos2d</code>中存在四种坐标系（<code>屏幕坐标系</code>、<code>Cocos2dx坐标系</code>、<code>世界坐标系</code>、<code>本地坐标系</code>），它们各自有自己的特点，接下来将对他们依次介绍。<br><br></p>
<h3 id="笛卡尔坐标系"><a href="#笛卡尔坐标系" class="headerlink" title="笛卡尔坐标系"></a>笛卡尔坐标系</h3><p>　　<code>Cocos2dx坐标系</code>和<code>OpenGL坐标系</code>相同，都是起源于<code>笛卡尔坐标系</code>。<br>　　笛卡尔坐标系中定义右手系原点在左下角，x向右，y向上，z向外，OpenGL坐标系为笛卡尔右手系。</p>
<center><br><img src="/img/quick-cocos2d-x/quick_3_5.png" alt="坐标轴"><br></center>

<p><br><strong>屏幕坐标系和Cocos2dx坐标系</strong><br>　　标准屏幕坐标系使用和<code>OpenGL</code>不同的坐标系，而<code>Cocos2dx</code>则使用和<code>OpenGL</code>相同的坐标系。<br>　　<code>iOS</code>，<code>Android</code>，<code>Windows Phone</code>等在开发普通应用时使用的是标准屏幕坐标系，即它们视屏幕左上角为原点，<code>x</code>向右为正方向，<code>y</code>向下为正方向。<br>　　而<code>Cocos2dx</code>坐标系和<code>OpenGL</code>坐标系一样，它们将屏幕左下角视为原点，<code>x</code>向右为正方向，<code>y</code>向上为正方向。</p>
<center><br><img src="/img/quick-cocos2d-x/quick_3_6.png" alt="屏幕坐标系和Cocos2d坐标系"><br></center>

<p>　　在开发中，我们还经常会提到两个比较抽象的概念：<code>世界坐标系</code>和<code>本地坐标系</code>。这两个概念可以帮助我们更好的理解节点在<code>Cocos2dx</code>坐标系中的位置以及对应关系。</p>
<p><br><strong>世界坐标系(World Coordinate)和本地坐标系（Node Local）</strong><br>　　<code>世界坐标系</code>也叫做<code>绝对坐标系</code>，是游戏开发中建立的概念。这里的<code>“世界”</code>指游戏世界。<br>　　<code>Cocos2dx</code>中的元素是有父子关系的层级结构，我们通过<code>Node</code>的<code>setPosition()</code>方法（关于Node类后面会详细介绍）设定元素的位置使用的是相对与其父节点的本地坐标系而非世界坐标系。最后在绘制屏幕的时候<code>Cocos2dx</code>会把这些元素的本地坐标映射成<code>世界坐标系坐标</code>。</p>
<p>　　<code>本地坐标系</code>也叫<code>相对坐标系</code>，是和节点相关联的坐标系。每个节点都有独立的坐标系，当节点移动或改变方向时，和该节点关联的坐标系将随之移动或改变方向。<br>　　Cocos2dx最终在屏幕中绘制元素时会把这些元素的<code>本地坐标映射成世界坐标系坐标</code>。</p>
<p>　　几乎所有的游戏引擎都会使用本地坐标系而非世界坐标系来指定元素的位置，这样做的好处是当计算物体运动的时候使用同一本地坐标系的元素可以作为一个子系统独立计算，最后再加上坐标系的运动即可，这是物理研究中常用的思路。例如一个在行驶的车厢内上下跳动的人，我们只需要在每帧绘制的时候计算他在车厢坐标系中的位置，然后加上车的位置就可以计算出人在世界坐标系中的位置，如果使用单一的世界坐标系，人的运动轨迹就变复杂了。<br><br></p>
<h3 id="锚点"><a href="#锚点" class="headerlink" title="锚点"></a>锚点</h3><p>　　通常我们习惯于只使用一个点来决定图片的位置的。选中了某个点后，图片的左上角就会被绘制到该点上。<br>　　比如，在App开发中向屏幕上绘制图片只需要提供三个参数即可： <code>图片对象</code>、<code>x坐标</code>、<code>y坐标</code>，然后图片的左上角就会被绘制到<code>x</code>和<code>y</code>的位置上。</p>
<p>　　但是在游戏开发中可能就会有更高的要求了，除了指定<code>position</code>（上面提到的<code>x</code>和<code>y</code>坐标）外，还需要指定一个锚点(<code>anchor point</code>)。<br>　　锚点用来指出<code>position</code>究竟是针对于图片的那个部位来说的。<br>　　比如，<code>g.drawImage(img,10,20,Gravity.LEFT|Gravity.TOP);</code>的作用就是在<code>(10,20)</code>这个地方画一个图片，而<code>Gravity.LEFT|Gravity.TOP</code>则表示，图片的左上角就会被画在<code>(10,20)</code>这个坐标上。<br>　　相应的，如果锚点是<code>Gravity.CENTER_HORIZONTAL|Gravity.CENTER_VERTICAL</code>，则表示图片的正中点就会被画在<code>(10，20)</code>这个坐标。</p>
<p>　　因此，一张图片的最终显示位置是由<code>position</code>和<code>锚点</code>来共同决定的。<br>　　锚点的范围是<code>[0,1]</code>，当设置<code>（0，0）</code>时是以左下角为锚点，当设置<code>（1，1）</code>时是以右上角角为锚点。<br>　　锚点的概念存在于任何的<code>Node</code>对象中。</p>
<p><br><strong>本节参考阅读：</strong></p>
<ul>
<li><a href="http://cn.cocos2d-x.org/article/index?type=cocos2d-x&amp;url=/doc/cocos-docs-master/manual/framework/native/v3/coordinate-system/zh.md" target="_blank" rel="noopener">Cocos2d-x 3.0坐标系详解</a></li>
</ul>
<h1 id="第二节-Hello-World"><a href="#第二节-Hello-World" class="headerlink" title="第二节 Hello World"></a>第二节 Hello World</h1><p>　　本系列文章将以<code>quick-cocos2d-x 3.3 rc1</code>做为讲解的基础，下载地址：<a href="http://cn.cocos2d-x.org/download" target="_blank" rel="noopener">http://cn.cocos2d-x.org/download</a> 。<br>　　<code>quick-cocos2d-x v3</code>是在<code>cocos2dx 3.x</code>的最新版本基础之上，移植了原来<code>quick-cocos2d-x</code>的核心框架、强大的player、丰富的示例等，并增加更多新的功能。</p>
<p>　　安装完毕后打开<code>quick-3.3rc1\README.html</code>就可以按照教程创建一个<code>HelloWorld</code>项目，但为了文章的完整性，本节会创建一个<code>HelloWorld</code>项目，并指出创建过程中可能出错的部分以供大家参考。</p>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>　　首先，运行<code>quick-cocos2d-x\player3.bat</code>文件来打开<code>quick</code>提供的<code>player</code>工具（即模拟器，它提供了创建、编译、模拟运行项目等功能）。<br>　　然后，点击“<code>新建项目</code>”，player会弹出如下界面：</p>
<center><br><img src="/img/quick-cocos2d-x/quick_3_7.jpg" alt="创建项目"><br></center>

<p>　　其中：<br>　　“<code>Choose Project Location</code>”用来选择项目的保存目录。<br>　　“<code>Package name</code>”设置项目的唯一标识。<br>　　点击“<code>Create Project</code>”按钮后，<code>player</code>会在<code>Project Location</code>目录下，用包名的最后一级名称来创建一个文件夹，用来存放新项目。<br>　　等待项目创建完毕后，关闭掉对话框，点击“<code>Open Project</code>”即可在<code>player</code>中运行该项目。</p>
<p>　　这里笔者有一句忠告：<code>如果你是一个新手，那么在首次搭建一个陌生的开发环境时，最好使用它们推荐的默认设置</code>。 笔者第一次使用<code>quick3.3</code>时把“<code>Copy Source Files</code>”项给去掉勾选了，结果导致项目总是没法编译出<code>apk</code>，耗费了半天多的时间才找到原因。</p>
<h2 id="编译项目"><a href="#编译项目" class="headerlink" title="编译项目"></a>编译项目</h2><p>　　若想让项目编译生成<code>apk</code>，则必须要先安装<code>Android SDK</code>和<code>Android NDK</code>。由于<code>Cocos2d-x 3.3</code>不支持<code>NDK r10</code>，我们需要下载<code>NDK r9d</code>用于编译。</p>
<p>　　<a href="http://developer.android.com/sdk/index.html" target="_blank" rel="noopener">[ 点击下载 Android SDK ]</a><br>　　<a href="http://dl.google.com/android/ndk/android-ndk-r9d-windows-x86_64.zip" target="_blank" rel="noopener">[ 点击下载 NDK - http://dl.google.com/android/ndk/android-ndk-r9d-windows-x86_64.zip ]</a></p>
<p><br>　　下载完<code>SDK</code>和<code>NDK</code>后，将它们解压到指定目录，然后需要配置一下环境变量，以<code>Windows</code>为例，在系统设置里添加以下环境变量：</p>
<pre><code>-  ANDROID_NDK_ROOT=D:\Work\android-ndk-r9d
-  ANDROID_SDK_ROOT=D:\Work\android-sdk
-  ANDROID_HOME=%ANDROID_SDK_ROOT%
</code></pre><p><br><strong>开始编译</strong><br>　　编译项目分两步：</p>
<pre><code>1、编译C++、lua代码。
2、编译Android端的java代码。
</code></pre><p>　　首先，我们打开cmd窗口，将<code>helloworld\frameworks\runtime-src\proj.android\build_native.bat</code>拖入窗口中，执行编译（编译的是<code>C++</code>和<code>lua</code>代码）。<br>　　首次编译的过程会很慢（以后就会很快了），而且中途<code>cmd</code>窗口会打印出很多“<code>warning</code>”，我们直接忽视它们，只要最终编译没出错即可。</p>
<p>　　如果一切顺利，我们将看到输出信息的中有如下几行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SharedLibrary  : libgame.so</span><br><span class="line">Install        : libgame.so =&gt; libs/armeabi/libgame.so</span><br></pre></td></tr></table></figure></p>
<p><br>　　运行<code>build_native</code>只是编译了<code>C++</code>部分，而<code>Android</code>应用还存在<code>Java</code>代码，这时就需要<code>Eclipse ADT</code>来进行了。<br>　　现在<code>Android</code>的开发者网站上的<code>SDK</code>安装包里，已经不包含<code>Eclipse</code>了，而变成了<code>Google</code>推出的<code>Android</code>开发专用的<code>IDE</code>软件<code>Android Studio</code>。<br>　　但是不论<code>Android Studio</code>还是<code>Eclipse</code>，都可以对<code>Android</code>项目进行编译，而且它们的界面也很相似，<code>Eclipse</code>的开发者很容易上手<code>Android Studio</code>。<br><br>　　启动<code>Eclipse</code>后，需要先导入<code>Cocos2d-x</code>的<code>Java</code>库：</p>
<pre><code>1、选择菜单File -&gt; Import，再选择Android -&gt; Existing Android Code Into Workspace
2、点击Browse按钮，选择quick目录中的cocos/platform/android/java
3、点击“Finish”完成操作。
</code></pre><p>　　接下来导入HelloWorld的<code>Android</code>工程：</p>
<pre><code>1、重复上述步骤，导入helloworld/frameworks/runtime-src/proj.android
2、在HelloWorld工程上点击右键选择菜单“Properties”打开工程设置对话框
3、从左侧选择Android，然后点击右侧“Add”按钮，将刚才导入的库添加进来（即一个名为java的项目）。
4、在菜单栏中点击Project -&gt; clean，完毕后即可运行。
</code></pre><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>　　为了更好的进行开发工作，下面来介绍一下HelloWorld项目的目录结构：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-  frameworks</span><br><span class="line">   -  cocos2d-x</span><br><span class="line">   -  runtime-src</span><br><span class="line">      -  proj.android</span><br><span class="line">-  res</span><br><span class="line">-  runtime</span><br><span class="line">   -  android</span><br><span class="line">   -  win32</span><br><span class="line">-  src</span><br><span class="line">   -  app</span><br><span class="line">   -  cocos</span><br><span class="line">   -  framework</span><br><span class="line">   -  config.lua</span><br><span class="line">   -  main.lua</span><br><span class="line">-  config.json</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  frameworks目录用来存放项目的C++、Java等源代码。
   -  cocos2d-x目录存放Cocos2dx的源码。
   -  runtime-src目录存放游戏的本地源码。
      -  proj.android表示Android源码。这个目录刚才我们也用过了。
      -  proj.ios_mac表示iOS和Mac源码。
-  res目录用来存放游戏的所有资源。如：图片、音乐、字体、视频。
-  runtime目录用来存放游戏编译后生成的可执行文件。
   -  android子目录用来存放生成的apk文件。
   -  win32用来存放生成的exe文件。
-  src目录用来存放游戏的lua源代码。
   -  app子目录用来存放我们编写的游戏的lua代码。
   -  cocos子目录存放cocos-lua中的一些lua代码。
   -  framework子目录存放quick针对cocos2dx进行封装的所有lua接口，我们后面章节中会重点学习它们。
   -  config.lua用来存放整个游戏运行时都会使用到的常量。
   -  main.lua是游戏在lua端的入口。以Android为例，游戏的真正入口其实是被标识为Home类型的一个Activity，然后经过一系列的调用，最终将会调用main.lua。
-  config.json文件保存模拟器相关的参数。
</code></pre><p>　　我们可以任意修改<code>src/framework</code>的代码，但是并不推荐这么做，因为当我们一旦需要升级<code>quick</code>到新版本时，就得把这些修改也放到新版本的<code>framework</code>中。</p>
<p>　　更详细的介绍请参看：<a href="http://cn.cocos2d-x.org/article/index?type=quick_doc&amp;url=/doc/cocos-docs-master/tutorial/framework/quick/quick-file-system/zh.md" target="_blank" rel="noopener">Quick-Cocos2d-x文件结构分析</a></p>
<h2 id="启动流程"><a href="#启动流程" class="headerlink" title="启动流程"></a>启动流程</h2><p>　　在此我们不打算关注当游戏被玩家启动后，程序在<code>Android</code>、<code>iOS</code>等端的启动流程是怎样的，而是会简单的介绍一下当游戏从它们那里（<code>Android</code>、<code>iOS</code>等端）执行到<code>Lua</code>端时，程序是如何运行的。另外这里只是一个简单的介绍，不明白也没有关系，后面的章节会详细介绍这里所涉及的知识。</p>
<p>　　在Lua端最先被调用的代码是“<code>main.lua</code>”文件。</p>
<p><br>　　范例1：src/main.lua。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> __G__TRACKBACK__<span class="params">(errorMessage)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"----------------------------------------"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"LUA ERROR: "</span> .. <span class="built_in">tostring</span>(errorMessage) .. <span class="string">"\n"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">debug</span>.<span class="built_in">traceback</span>(<span class="string">""</span>, <span class="number">2</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"----------------------------------------"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将src目录添加到搜索路径中去（在第二章 Lua 程序设计中已经详细介绍了package.path的作用）。</span></span><br><span class="line"><span class="built_in">package</span>.<span class="built_in">path</span> = <span class="built_in">package</span>.<span class="built_in">path</span> .. <span class="string">";src/"</span></span><br><span class="line">cc.FileUtils:getInstance():setPopupNotify(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 首先，加载当前目录(即src)下的子目录app下的MyApp.lua文件。</span></span><br><span class="line"><span class="comment">-- 然后，通过MyApp.lua返回的引用来调用new()方法创建一个MyApp对象。</span></span><br><span class="line"><span class="comment">-- 最后，调用MyApp对象的run()方法。</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"app.MyApp"</span>).new():run()</span><br></pre></td></tr></table></figure></p>
<p><br>　　范例2：src/app/MyApp.lua。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 下面的三行代码用来加载quick所必需要的库文件。</span></span><br><span class="line"><span class="comment">-- 如果没有特殊指明，那么require函数只会从src目录下开始查找。如：会从src/cocos目录下加载init.lua文件。</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"config"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"cocos.init"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"framework.init"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建一个MyApp类，并使其继承framework/cc/mvc/AppBase类。</span></span><br><span class="line"><span class="keyword">local</span> MyApp = class(<span class="string">"MyApp"</span>, cc.mvc.AppBase)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MyApp类的构造方法，当调用MyApp.new()创建对象时会导致此方法被调用。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyApp:ctor</span><span class="params">()</span></span></span><br><span class="line">    MyApp.super.ctor(self)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- MyApp类的实例方法。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyApp:run</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">-- 游戏中会执行大量的加载图片、音乐、字体等操作。</span></span><br><span class="line">    <span class="comment">-- 下面这行代码告诉系统，当需要加载这些资源时，可以从项目根目录下的res目录中查找。</span></span><br><span class="line">    cc.FileUtils:getInstance():addSearchPath(<span class="string">"res/"</span>)</span><br><span class="line">    <span class="comment">-- 调用父类AppBase定义的函数，进入到指定的Scene中。</span></span><br><span class="line">    self:enterScene(<span class="string">"MainScene"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 返回MyApp类的引用。</span></span><br><span class="line"><span class="keyword">return</span> MyApp</span><br></pre></td></tr></table></figure></p>
<p>　　在其他面向对象语言中，类是模版，对象是实例，我们不可以去直接使用类。<br>　　但请记住：<code>Lua</code>本身并不支持面向对象编程，它通过“<code>表</code>”来实现面向对象，难免会有一些和其他语言语法不同的地方。<br>　　比如，<code>MyApp</code>本质上也是一个对象(表)，只不过我们将其视为一个类。它和<code>Java</code>中的字节码对象(<code>Class</code>)是一样的，对象的创建是通过<code>MyApp</code>对象的<code>new()</code>方法完成的。</p>
<p><br>　　通常一个类会单独写在一个<code>Lua</code>文件中，当<code>require</code>该文件后会需要接着调用该类的函数，因而都会在<code>Lua</code>文件的最后一行将该类的引用返回。</p>
<p><br>　　游戏从<code>main.lua</code>进入的第一个类通常要继承<code>cc.mvc.AppBase</code>类，该类提供了一些控制游戏的方便函数。 当然这个继承并不是必须的，就像我们上厕所大便时，也不强制人一定要带纸，但谁又会不带纸呢。<br>　　<code>AppBase</code>类的对象会被全局保存着(使用一个名为<code>app</code>的变量)，因此你可以在任何<code>lua</code>文件中引用它。<br>　　默认情况下<code>enterScene()</code>函数会去“<code>app.senes</code>”目录下去查找，因此在本范例中就是查找“<code>app.scenes.MainScene</code>”。</p>
<p><br>　　范例3：src/app/scenes/MainScene.lua。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 定义一个MainScene类，并使它继承cc.Scene类</span></span><br><span class="line"><span class="keyword">local</span> MainScene = class(<span class="string">"MainScene"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> display.newScene(<span class="string">"MainScene"</span>)</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 构造方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MainScene:ctor</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">-- 创建一个文本控件，内容为Hell World，并将它显示在屏幕的正中央。</span></span><br><span class="line">    cc.ui.UILabel.new(&#123;</span><br><span class="line">            UILabelType = <span class="number">2</span>, text = <span class="string">"Hello, World"</span>, size = <span class="number">64</span>&#125;)</span><br><span class="line">        :align(display.CENTER, display.cx, display.cy)</span><br><span class="line">        :addTo(self)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> MainScene</span><br></pre></td></tr></table></figure></p>
<pre><code>语句解释：
-  在Cocos2dx中场景使用cc.Scene类来表示，自定义的场景必须要继承该类。
-  上面的display.newScene(&quot;MainScene&quot;)用来创建一个cc.Scene对象，关于该代码将在下一章详细介绍进行。
-  为了方便代码管理，一个cc.Scene通常单独写在一个文件中，且使用local关键字修饰，而且在最后一行应该返回其自身的引用。
-  cc.ui.UILabel是一个文本标签，用来显示文字，具体后述。
-  默认情况下，元素的锚点是(0.5,0.5)，可以直接将元素添加到CCScene中。
</code></pre><p><br>　　提示：Cocos2dx中，所有的场景、层、精灵都是<code>cc.Node</code>类的子类。</p>
<p><br><br></p>

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
        </div>
      

      
      
    </footer>
  </article>


  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="cocos2dx-lua-003/"
           data-title="Cocos2dx - Lua篇 第三章 环境搭建" data-url="http://yoursite.com/cocos2dx-lua-003/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="乐信圣文" />
          <p class="site-author-name" itemprop="name">乐信圣文</p>
          <p class="site-description motion-element" itemprop="description">集大家之成，悟小家之道。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">49</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="http://www.gov.cn/" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#第一节-基础概念"><span class="nav-number">1.</span> <span class="nav-text">第一节 基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#游戏组成"><span class="nav-number">1.1.</span> <span class="nav-text">游戏组成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#导演（Diretor）"><span class="nav-number">1.1.1.</span> <span class="nav-text">导演（Diretor）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#场景（Scene）"><span class="nav-number">1.1.2.</span> <span class="nav-text">场景（Scene）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#层（Layer）"><span class="nav-number">1.1.3.</span> <span class="nav-text">层（Layer）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#精灵（Sprite）"><span class="nav-number">1.1.4.</span> <span class="nav-text">精灵（Sprite）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#整体结构"><span class="nav-number">1.2.</span> <span class="nav-text">整体结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cocos2d-x-3-0坐标系详解"><span class="nav-number">1.3.</span> <span class="nav-text">Cocos2d-x 3.0坐标系详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#坐标系"><span class="nav-number">1.3.1.</span> <span class="nav-text">坐标系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#笛卡尔坐标系"><span class="nav-number">1.3.2.</span> <span class="nav-text">笛卡尔坐标系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#锚点"><span class="nav-number">1.3.3.</span> <span class="nav-text">锚点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第二节-Hello-World"><span class="nav-number">2.</span> <span class="nav-text">第二节 Hello World</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建项目"><span class="nav-number">2.1.</span> <span class="nav-text">创建项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编译项目"><span class="nav-number">2.2.</span> <span class="nav-text">编译项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#项目结构"><span class="nav-number">2.3.</span> <span class="nav-text">项目结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动流程"><span class="nav-number">2.4.</span> <span class="nav-text">启动流程</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">乐信圣文</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"cutler"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("sGcgYofeKOFi2l1XvGrm0PcP-gzGzoHsz", "Sx0mWxj4pkXYm17zT0UnV5Ca");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
