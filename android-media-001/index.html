<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="http://www.gov.cn/" title="乐信圣文" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="对于一部嵌入式设备来说，除了基础功能（通话、短信）外，最重要的可能就是多媒体了。那么一个最简单的问题，什么是多媒体呢？ 从字面上来看，这个术语对应的英文单词是“Multi-Media”，直译过来就是多媒体。 简单的说，多媒体是各种形式的媒体（比如文本、音频、视频、图片、动画等等）的组合。 　　媒体篇将讲解如何在你的应用中增加视频，音频以及图片处理的相关技术。 第一节 基础概念　　在讲解如何使用">
<meta property="og:type" content="article">
<meta property="og:title" content="多媒体篇 第一章 音频">
<meta property="og:url" content="http://yoursite.com/android-media-001/index.html">
<meta property="og:site_name" content="乐信圣文">
<meta property="og:description" content="对于一部嵌入式设备来说，除了基础功能（通话、短信）外，最重要的可能就是多媒体了。那么一个最简单的问题，什么是多媒体呢？ 从字面上来看，这个术语对应的英文单词是“Multi-Media”，直译过来就是多媒体。 简单的说，多媒体是各种形式的媒体（比如文本、音频、视频、图片、动画等等）的组合。 　　媒体篇将讲解如何在你的应用中增加视频，音频以及图片处理的相关技术。 第一节 基础概念　　在讲解如何使用">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/img/android/android_5_1.png">
<meta property="og:updated_time" content="2019-10-21T04:16:18.494Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="多媒体篇 第一章 音频">
<meta name="twitter:description" content="对于一部嵌入式设备来说，除了基础功能（通话、短信）外，最重要的可能就是多媒体了。那么一个最简单的问题，什么是多媒体呢？ 从字面上来看，这个术语对应的英文单词是“Multi-Media”，直译过来就是多媒体。 简单的说，多媒体是各种形式的媒体（比如文本、音频、视频、图片、动画等等）的组合。 　　媒体篇将讲解如何在你的应用中增加视频，音频以及图片处理的相关技术。 第一节 基础概念　　在讲解如何使用">
<meta name="twitter:image" content="http://yoursite.com/img/android/android_5_1.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/android-media-001/"/>

  <title> 多媒体篇 第一章 音频 | 乐信圣文 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?53b4b0b5aeb5df5e4fb6263a58d8e1a9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">乐信圣文</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-feedback">
          <a href="/feedback" rel="section">
            
            联系我们
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                多媒体篇 第一章 音频
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            
              <span class="post-meta-item-text">Cutler</span>
            
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-03-02T19:03:10+08:00" content="2015-03-02">
              2015-03-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android-初级开发/" itemprop="url" rel="index">
                    <span itemprop="name">Android - 初级开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          

          
          
             <span id="/android-media-001/" class="leancloud_visitors" data-flag-title="多媒体篇 第一章 音频">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>　　对于一部嵌入式设备来说，除了基础功能（通话、短信）外，最重要的可能就是多媒体了。那么一个最简单的问题，什么是多媒体呢？ 从字面上来看，这个术语对应的英文单词是<code>“Multi-Media”</code>，直译过来就是多媒体。</p>
<pre><code>简单的说，多媒体是各种形式的媒体（比如文本、音频、视频、图片、动画等等）的组合。
</code></pre><p>　　媒体篇将讲解如何在你的应用中增加视频，音频以及图片处理的相关技术。</p>
<h1 id="第一节-基础概念"><a href="#第一节-基础概念" class="headerlink" title="第一节 基础概念"></a>第一节 基础概念</h1><p>　　在讲解如何使用Android提供的API进行录音之前，先介绍一些音频相关的基本概念。</p>
<p>　　声音（<code>sound</code>)是由物体振动产生的<code>声波</code>。<br>　　声音通过介质（空气或固体、液体）传播，然后被人或动物听觉器官所感知，最初发出振动（震动）的物体叫<code>声源</code>。</p>
<p>　　在计算机领域有两个常用的术语：模拟音频信号和数字音频信号。</p>
<pre><code>-  模拟音频信号(Analog Signal)：指自然界中的各种声音，我们通常又把模拟信号称为连续信号，它在一定的时间范围内可以有无限多个不同的取值。
-  数字音频信号(Digital Signal)：指保存在计算机中的声音。由于模拟音频信号在一个时间范围内有无限多个取值，所以我们无法把自然界声音无损的保存到计算机中（计算机硬盘的存储容量有限），只能对声音进行采样处理，采样出来的声音只需要达到人耳分辨不出来的水平就可以了。
</code></pre><p>　　在电脑上录音的本质就是把自然界中的<code>模拟声音信号</code>转换成计算机所能表示的<code>数字音频信号</code>。<br>　　反之，在播放时则是把<code>数字信号</code>还原成<code>模拟音频信号</code>输出。</p>
<p><br><strong>音频的录制、存储与回放</strong><br>　　<code>Multi-Media</code>并不是专门为计算机而生的——只不过后者的出现极大地推动了它的发展。那么和传统的多媒体相比，计算机领域的多媒体系统，会有哪些区别呢？<br>　　一个很显然的问题是，我们如何将各种媒体源数字化呢？比如，早期的音频信息是存储在录音带中的，以模拟信号的形式存储。而到了计算机时代，这些音频数据必须通过一定的处理手段才可能存储到设备中，这是我们在数字化时代会遇到的一个常见问题。下面这个图很好地描述了音频从录制到播放的一系列操作流程：</p>
<center><br><img src="/img/android/android_5_1.png" alt="图片引用自维基百科"><br></center>

<p><br><strong>录制过程</strong><br>　　首先，音频采集设备（比如<code>Microphone</code>麦克风）捕获声音信息，初始数据是模拟信号。<br>　　然后，使用模-数转换器（<code>Analog to Digital Converter</code>）将模拟信号处理成计算机能接受的二进制数据，即数字信号。 随后数据根据需求进行必要的渲染处理，比如音效调整、过滤等等。<br>　　此时，处理后的音频数据理论上已经可以存储到计算机设备中了，比如硬盘、USB设备等等。不过由于这时的音频数据体积相对庞大，不利于保存和传输，通常还会对其进行压缩处理。比如我们常见的<code>mp3</code>音乐，实际上就是对原始数据采用相应的压缩算法后得到的。压缩过程根据采样率、位深等因素的不同，最终得到的音频文件可能会有一定程度的失真，<br>　　另外，音视频的编解码既可以由纯软件完成，也同样可以借助于专门的硬件芯片来完成。</p>
<p><br><strong>回放过程</strong><br>　　回放过程总体上是录制过程的逆向操作。<br>　　首先，从存储设备中取出相关文件，并根据录制过程采用的编码方式进行相应的解码。即将压缩后的数据还原成未压缩之前的状态。<br>　　然后，音频系统为这一播放实例选定最终匹配的音频回放设备。<br>　　接着，解码后的数据经过音频系统设计的路径传输。<br>　　接着，音频数据信号通过数模转换器(<code>Digital to Analog Converter</code>)变换成模拟信号。<br>　　最后，模拟信号经过回放设备，还原出原始声音。</p>
<h1 id="第二节-音频采集"><a href="#第二节-音频采集" class="headerlink" title="第二节 音频采集"></a>第二节 音频采集</h1><p>　　声音信号是一种模拟信号，计算机要对它进行处理，必须将它转换为数字声音信号，即用二进制数字的编码形式来表示声音。将模拟信号转换成数字信号，并存放在存储器中的过程，称为数字音频采集。</p>
<p>　　将模拟音频信号转换为数字音频信号通常要经过：<code>抽样</code>、<code>量化</code>，<code>编码</code>三个步骤。</p>
<p><br><strong>抽样</strong><br>　　抽样也称为<code>采样</code>。由于声音其实是一种能量波，因此也有频率和振幅的特征，频率对应于时间轴线，振幅对应于电平轴线。波是无限光滑的，弦线可以看成由无数点组成，由于存储空间是相对有限的，数字编码过程中，必须对弦线的点进行采样。<br>　　采样频率，也称为采样速度或者采样率，定义了每秒从连续信号中提取并组成离散信号的采样个数，它用赫兹（<code>Hz</code>）来表示。采样频率的倒数是采样周期或者叫作采样时间，它是采样之间的时间间隔。通俗的讲采样频率是指计算机每秒钟采集多少个声音样本，是描述声音文件的音质、音调，衡量声卡、声音文件的质量标准。<br>　　采样频率必须至少是信号中最大频率分量频率的两倍，否则就不能从信号采样中恢复原始信号。如果信号的带宽是<code>100Hz</code>，那么为了避免混叠现象采样频率必须大于<code>200Hz</code>。人耳能够感觉到的最高频率为<code>20kHz(1kHz = 1000Hz)</code>，太高的频率就分辨不出好坏来，因此要满足人耳的听觉要求，则需要至少每秒进行<code>40k</code>次采样，用<code>40kHz</code>表达，这个<code>40kHz</code>就是采样率。</p>
<p>　　扩展问题：既然<code>20kHz</code>已经分辨不清楚，为什么还有<code>48kHz</code>的采样率?</p>
<p><br><strong>量化</strong><br>　　量化就是把采样得到的样本（模拟量）转换为离散值（数字量）表示。因此量化的过程有时也被称为<code>A/D</code>转换（模数转换）。量化后的样本是用二进制数表示的，二进制数位的多少反映了度量声音波形幅度的精度，称为量化精度。例如，若每个声音样本用<code>16</code>位表示，则声音样本的取值范围是<code>0~65535</code>，精度是<code>1/65536</code>。若每个声音样本用<code>8</code>位表示，则声音样本的取值范围是<code>0~255</code>，精度是<code>1/256</code>。<br>　　量化精度越高，声音的质量越好，需要的存储空间也越多。CD标准的量化精度是<code>16Bit</code>，DVD标准的量化精度是<code>24Bit</code>。</p>
<p><br><strong>编码</strong><br>　　根据采样率和量化精度可以得知，相对自然界的信号，音频编码最多只能做到无限接近，至少目前的技术只能这样了，相对自然界的信号，任何数字音频编码方案都是有损的，因为无法完全还原。在计算机应用中，能够达到最高保真水平的就是<code>PCM</code>编码，被广泛用于素材保存及音乐欣赏，<code>CD</code>、<code>DVD</code>以及我们常见的<code>WAV</code>文件中均有应用。因此，<code>PCM</code>约定俗成了无损编码，因为<code>PCM</code>代表了数字音频中最佳的保真水准，并不意味着<code>PCM</code>就能够确保信号绝对保真，<code>PCM</code>也只能做到最大程度的无限接近。我们而习惯性的把<code>MP3</code>列入有损音频编码范畴，是相对<code>PCM</code>编码的。强调编码的相对性的有损和无损，是为了告诉大家，要做到真正的无损是困难的，就像用数字去表达圆周率，不管精度多高，也只是无限接近，而不是真正等于圆周率的值。<br>　　经过采样和量化后的声音信号已经是数字形式了，但是为了便于计算机的存储、处理、传输，还必须按照一定的要求进行数据压缩和编码。</p>
<p>　　为了更形象的解释为什么要对量化后的音乐进行压缩和编码，先介绍两个有关音频编码很重要的术语：<code>比特率</code>和<code>声道</code>。</p>
<p><br><strong>比特率</strong><br>　　比特率是音频文件每秒占据的字节数（比特数），当你在使用比较低的比特率时，你将会丢失声音质量。<br>　　比特率规定使用“比特每秒”（<code>bit/s</code>或<code>bps</code>）为单位，<code>ps</code>指的是<code>/s</code>，即每秒。<br>　　经常和国际单位制词头关联在一起，如“千”（<code>kbit/s</code>或<code>kbps</code>），“兆”（<code>Mbit/s</code>或<code>Mbps</code>），“吉”（<code>Gbit/s</code>或<code>Gbps</code>) 和“太”（<code>Tbit/s</code>或<code>Tbps</code>）。<br>　　CD中的数字音乐比特率为<code>1411.2kbps</code>（也就是记录1秒钟的cd音乐，需要<code>1411.2×1000</code>比特的存储空间）。</p>
<p><br><strong>声道</strong><br>　　一个声道(<code>AudioChannel</code>)，简单来讲就代表了一种独立的音频信号，所以双声道理论上就是两种独立音频信号的混合。具体而言，如果我们在录制声音时在不同空间位置放置两套采集设备（或者一套设备多个采集头），就可以录制两个声道的音频数据了。后期对采集到的声音进行回放时，通过与录制时相同数量的外放扬声器来分别播放各声道的音频，就可以尽可能还原出录制现场的真实声音了。</p>
<p>　　声道的数量发展经历了几个重要阶段，分别是：</p>
<pre><code>-  Monaural（单声道）
   -  早期的音频录制是单声道的，它只记录一种音源，所以在处理上相对简单。播放时理论上也只要一个扬声器就可以了——即便有多个扬声器，它们的信号源也是一样的，起不到很好的效果
-  Stereophonic（立体声）
   -  之所以称为立体声，是因为人们可以感受到声音所产生的空间感：大自然中的声音就是立体的，比如办公室里键盘敲击声，马路上汽车鸣笛，人们的说话声等等。
</code></pre><p>　　那么这些声音为什么会产生立体感呢？<br>　　我们知道，当音源发声后（比如你右前方有人在讲话），音频信号将分别先后到达人类的双耳。在这个场景中，是先传递到右耳然后左耳，并且右边的声音比左边稍强。这种细微的差别通过大脑处理后，我们就可以判断出声源的方位了。<br>　　这个原理现在被应用到了多种场合。在音乐会的录制现场，如果我们只使用单声道采集，那么后期回放时所有的音乐器材都会从一个点出来；反之，如果能把现场各方位的声音单独记录下来，并在播放时模拟当时的场景，那么就可以营造出音乐会的逼真氛围。<br>　　最基本的立体声是两声道：<code>左声道</code>、<code>右声道</code>。还有更多声道的<code>立体声</code>，也即环绕声，其中包括主要的左右声道，还有环绕的副声道左右，中置，单独低音等5-7个声道。</p>
<p><br><strong>为什么要压缩?</strong><br>　　要算一个PCM音频流的码率是一件很轻松的事情，公式为：采样率×采样大小（即量化精度）×声道数。<br>　　如一个采样率为<code>44.1KHz</code>，采样大小为<code>16bit</code>，双声道的<code>PCM</code>编码的<code>WAV</code>文件，它的数据速率则为：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">44.1</span>K × <span class="number">16</span> × <span class="number">2</span> = <span class="number">1411.2</span>Kbps</span><br></pre></td></tr></table></figure></p>
<p>　　然后再将码率除以<code>8</code>，就可以得到这个<code>WAV</code>的数据速率，即<code>176.4KB/s</code>。<br>　　这表示存储一秒钟采样率为<code>44.1KHz</code>，采样大小为<code>16bit</code>，双声道的<code>PCM</code>编码的音频信号，需要<code>176.4KB</code>的空间，<code>1</code>分钟则约为<code>10.34M</code>。<br>　　显然，这对大部分用户是不可接受的，尤其是喜欢在电脑上听音乐的朋友，要降低磁盘占用，只有两种方法：</p>
<pre><code>-  降低采样指标。
-  压缩。
</code></pre><p>　　降低指标是不可取的，因此专家们研发了各种压缩方案。<br>　　由于用途和针对的目标市场不一样，各种音频压缩编码所达到的音质和压缩比都不一样。有一点是可以肯定的，它们都压缩过。</p>
<h1 id="第三节-开始录音"><a href="#第三节-开始录音" class="headerlink" title="第三节 开始录音"></a>第三节 开始录音</h1><p>　　在Android中有两种方法可以实现录音功能，使用<code>MediaRecorder</code>类和<code>AudioRecorder</code>类：</p>
<pre><code>-  MediaRecorder类十分简单好用，但是灵活性不足。
-  AudioRecorder提供了更多的自由度，但是使用稍微会有点复杂，它们各自有对应的应用场景。
</code></pre><p><br><strong>具体区别：</strong></p>
<p>　　首先，录音时输出的数据不同。</p>
<pre><code>-  MediaRecorder录制出来的是一个音频文件。该文件是经过压缩后的，即在录音之前需要为其设置编码方式等一系列参数，设置完毕后MediaRecorder类会依据参数值自动完成声音的收集、编码、压缩等步骤。
-  AudioRecorder直接捕获到的是未经过任何处理的原始音频流，开发者可以实时随意处理音频流。
</code></pre><p>　　然后，对声音操作的自由度不同。</p>
<pre><code>-  MediaRecorder将录音的所有步骤都封装起来，只会输出一个声音文件。
-  AudioRecorder可以实现边录边播（实现即时聊天功能）以及对音频的实时处理，如降噪，合成（如“会说话的汤姆猫”）。
   -  优点：语音的实时处理，可以用代码实现各种音频的封装。
   -  缺点：输出是PCM语音数据，如果保存成音频文件，是不能够直接播放的，必须另写代码对PCM数据编码和压缩。
</code></pre><h2 id="MediaRecorder"><a href="#MediaRecorder" class="headerlink" title="MediaRecorder"></a>MediaRecorder</h2><p>　　使用<code>MediaRecorder</code>类从设备捕捉音频的大体步骤： </p>
<pre><code>1、创建一个新实例android.media.MediaRecorder。
2、使用MediaRecorder.setAudioSource()设置音频源。
3、使用MediaRecorder.setOutputFormat()设置输出文件格式。
4、使用MediaRecorder.setOutputFile()设置输出文件名。
5、使用MediaRecorder.setAudioEncoder()设置音频编码器。
6、在MediaRecorder实例上调用MediaRecorder.prepare()。
7、调用MediaRecorder.start()开始音频捕捉。
8、调用MediaRecorder.stop()停止音频捕捉。
9、录音完毕后调用MediaRecorder.release()方法释放资源。
</code></pre><p>　　<code>MediaRecorder</code>类的具体用法请参考<a href="http://developer.android.com/guide/topics/media/audio-capture.html" target="_blank" rel="noopener"> Audio Capture </a>。</p>
<p><br><strong>音频源：</strong><br>　　音频源指从何处录制声音，通常会选择电话的“麦克风”。 使用<code>MediaRecorder.AudioSource</code>类来表示可选的所有音频源。</p>
<p>　　范例1：<code>MediaRecorder.AudioSource</code>类。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MediaRecorder.AudioSource.MIC                    麦克风，即手机话筒</span><br><span class="line">MediaRecorder.AudioSource.DEFAULT                默认情况下通常代表MIC</span><br><span class="line">MediaRecorder.AudioSource.VOICE_CALL             Voice call uplink and downlink source</span><br><span class="line">MediaRecorder.AudioSource.VOICE_DOWNLINK         Voice call downlink source</span><br><span class="line">MediaRecorder.AudioSource.VOICE_UPLINK           Voice call uplink source</span><br><span class="line">MediaRecorder.AudioSource.VOICE_RECOGNITION      Usually DEFAULT source</span><br></pre></td></tr></table></figure></p>
<p><br><strong>文件格式与音频编码：</strong><br>　　首先我们要知道的是，每个音频文件都有两部分：<code>文件格式</code>（也叫音频容器），<code>数据格式</code>（也叫音频编码）。<br>　　<code>文件格式</code>描述了这个文件它自己的格式，而它里面的实际音频数据能使用很多不同的方式编码。例如，一个后缀为<code>caf</code>的文件是一种文件格式，它能够包含用<code>MP3</code>、<code>线性pcm</code>等其他许多格式编码的音频数据。<br>　　换句话说，文件格式就像是桶一样，里面可以装很多水，那些水就是那些<code>音频数据</code>。桶有很多种外形，也就是有很多种文件格式，而且不一样的桶，也需要装不同的水（石油桶用来装石油）。<code>caf</code>这种桶就可以装各种各样的水，不过有些桶就只能装几种类型的水。</p>
<p>　　使用<code>MediaRecorder</code>类的<code>setOutputFormat()</code>方法可以设置录音时，输出的音频文件的格式。<code>MediaRecorder.OutputFormat</code>类来表示可选的音频文件格式。</p>
<p><br>范例2：<code>MediaRecorder.OutputFormat</code>类。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MediaRecorder.OutputFormat.AMR_NB               API Level 10</span><br><span class="line">MediaRecorder.OutputFormat.AMR_WB               API Level 10</span><br><span class="line">MediaRecorder.OutputFormat.DEFAULT              API Level 1</span><br><span class="line">MediaRecorder.OutputFormat.MPEG_4               API Level 1</span><br><span class="line">MediaRecorder.OutputFormat.RAW_AMR              API Level 3 </span><br><span class="line">MediaRecorder.OutputFormat.THREE_GPP            API Level 1</span><br><span class="line">MediaRecorder.OutputFormat.AAC_ADTS             API Level 16</span><br></pre></td></tr></table></figure></p>
<p><br><strong>AMR</strong><br>　　<code>AMR</code>(<code>Adaptive multi-Rate</code>简称自适应多速率音频编码) 它即是一种音频编码格式也是一种文件格式。<br>　　<code>AMR</code>编码压缩比非常高，但是音质比较差，主要用于语音类的音频压缩，效果还是很不错的，不适合对音质要求较高的音乐、歌曲类音频的压缩。<br>　　现在很多智能手机都支持多媒体功能，特别是音频和视频播放功能，而<code>AMR</code>文件格式是手机端普遍支持的音频文件格式。<br>　　<code>AMR</code>文件就是存储<code>AMR</code>语音编码的音频文件。<br>　　很多手机允许你存储短时间的<code>AMR</code>格式录音，在开源和商业软件有和其他格式转换的程序，例如<code>MP3</code>，但是要记住<code>AMR</code>并不是理想的记录声音的方式。<code>AMR</code>文件扩展名是<code>.amr</code>。<br>　　<code>AMR</code>被标准语音编码<code>3GPP</code>在<code>1998年10月</code>选用，现在广泛在<code>GSM</code>和<code>UMTS</code>中使用。它使用<code>1-8</code>个不同的位速编码。<br>　　<code>AMR</code>又称为<code>AMR-NB</code>，即窄带自适应多速率，还有另一种<code>AMR-WB</code>宽带自适应多速率。</p>
<p><br><strong>RAW_AMR</strong><br>　　此常量与<code>AMR_NB</code>等价。在<code>API Level 16</code>中已经不推荐使用，改用<code>AMR_NB</code>代替。</p>
<p><br><strong>THREE_GPP</strong><br>　　即<code>.3gp</code>格式的文件，通常是以视频文件的形式展现。<br>　　<code>3GP</code>是一种多媒体储存格式，由<code>Third Generation Partnership Project（3GPP）</code>定义的，<code>MPEG-4 Part 14（MP4）</code>的一种简化版本，减少了储存空间和较低的带宽需求，主要用于<code>3G</code>手机上，让手机上有限的储存空间可以使用。<br>　　<code>3GP</code>档案影像的部份可以用<code>MPEG-4 Part 2、H.263</code>或<code>MPEG-4 Part 10 (AVC/H.264)</code>等格式来储存，声音的部份则支援<code>AMR-NB</code>、<code>AMR-WB</code>、<code>AMR-WB+</code>、<code>AAC-LC</code>或<code>HE-AAC</code>来当作声音的编码。目前<code>3GP</code>档案有两种不同的标准：</p>
<pre><code>-  3GPP（针对GSM手机，副档名为.3gp）
-  3GPP2（针对CDMA手机，副档名为.3g2）
</code></pre><p>　　这两种格式影像方面都采用<code>MPEG-4</code>及<code>H.263</code>，而声音则采用<code>AAC</code>或<code>AMR</code>标准。</p>
<p>　　3GP格式视频有两种分辨率：</p>
<pre><code>1、分辨率176×144，适合市面上所有支持3GP格式的手机。
2、分辨率320×240，清晰，适合高档手机、MP4播放器、PSP以及苹果iPod.
</code></pre><p><br><strong>AAC</strong><br>　　<code>AAC(Advanced Audio Coding简称高级音频编码)</code>基于<code>MPEG-2</code>的音频编码技术。目的是取代<code>MP3</code>格式。<br>　　<code>2000</code>年，<code>MPEG-4</code>标准出现后，<code>AAC</code>重新集成了其特性，加入了<code>SBR</code>技术和<code>PS</code>技术，为了区别于传统的<code>MPEG-2 AAC</code>又称为<code>MPEG-4 AAC</code>。<br>　　作为一种高压缩比的音频压缩算法，AAC压缩比通常为<code>18：1</code>，也有数据说为<code>20：1</code>，远胜<code>mp3</code>；在音质方面，由于采用多声道，和使用低复杂性的描述方式，使其比几乎所有的传统编码方式在同规格的情况下更胜一筹。<br>　　但是<code>AAC</code>在Android的<code>API Level 16</code>以后才支持的。<br>　　注：视频文件也同样区分文件格式和编码格式</p>
<p><br>　　  使用<code>MediaRecorder</code>类的<code>setAudioEncoder()</code>方法可以设置录音时所要使用的音频编码格式。</p>
<p><br>　　范例3：<code>MediaRecorder.AudioEncoder</code>类。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MediaRecorder.AudioEncoder.AAC                   API Level 10</span><br><span class="line">MediaRecorder.AudioEncoder.AAC_ELD               API Level 16</span><br><span class="line">MediaRecorder.AudioEncoder.AMR_NB                API Level 1</span><br><span class="line">MediaRecorder.AudioEncoder.AMR_WB                API Level 10</span><br><span class="line">MediaRecorder.AudioEncoder.DEFAULT               API Level 1</span><br><span class="line">MediaRecorder.AudioEncoder.HE_ACC                API Level 16</span><br></pre></td></tr></table></figure></p>
<h2 id="AudioRecord"><a href="#AudioRecord" class="headerlink" title="AudioRecord"></a>AudioRecord</h2><p>　　刚刚介绍了如何使用<code>MediaRecorder</code>类来进行录音，该类十分容易使用并且可以简单快速的进行录音，同时也可以将音频压缩存储为<code>mpeg4</code>或者<code>3gpp</code>格式的。但是如果你需要原始数据，做一些音频处理，则就无法使用<code>MediaRecorder</code>类来完成了。<code>AudioRecord</code>类则可以输出未压缩的原始音频流，你可以将音频流写入到一个文件，保存为<code>wav</code>格式等。</p>
<p><br>　　使用<code>AudioRecord</code>类记录音频的步骤如下： </p>
<pre><code>1、创建一个android.media.AudioRecord类的实例。
2、使用AudioRecord.startRecording()方法开始录音。
3、使用AudioRecord.read()方法读取录到的原始音频流。
4、使用AudioRecord.stop()方法停止录音。
</code></pre><p><br>　　范例1：<code>AudioRecord</code>类构造方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//  第一个参数：指定音频源，取值可以是MediaRecorder.AudioSource类定义的常量。</span><br><span class="line">//  第二个参数：设置采样率，单位Hz，44100Hz是唯一可以在所有设备上正常工作的。</span><br><span class="line">//             但是也有其他采样率如22050，16000和11025可以在某些设备上工作。</span><br><span class="line">//  第三个参数：设置声道数。取值为：AudioFormat.CHANNEL_IN_MONO 和 AudioFormat.CHANNEL_IN_STEREO。</span><br><span class="line">//             前者通常可以在所有设备上正常工作。</span><br><span class="line">//  第四个参数：设置音频的编码格式。取值为：AudioFormat.ENCODING_PCM_16BIT 和 AudioFormat.ENCODING_PCM_8BIT。</span><br><span class="line">//  第五个参数：设置录音时，用于保存录出来的音频数据的buffer大小。</span><br><span class="line">//             如果你不知道如何设置缓冲区大小，则可以调用getMinBufferSize(int, int, int)方法来计算。</span><br><span class="line">//             该方法中的三个参数的含义和此构造方法的参数完全相同。</span><br><span class="line">public AudioRecord(int audioSource,int sampleRateInHz,int channelConfig,int audioFormat,int bufferSizeInBytes)</span><br></pre></td></tr></table></figure></p>
<p><br><br><strong>本节参考阅读：</strong></p>
<ul>
<li><a href="http://www.androiddevblog.net/android/android-audio-recording-part-2" target="_blank" rel="noopener">www.androiddevblog.net（链接已失效）</a> </li>
<li><a href="http://developer.android.com/intl/zh-CN/reference/android/media/AudioRecord.html" target="_blank" rel="noopener">http://developer.android.com/intl/zh-CN/reference/android/media/AudioRecord.html</a> </li>
</ul>
<p><br><br></p>

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
        </div>
      

      
      
    </footer>
  </article>


  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="android-media-001/"
           data-title="多媒体篇 第一章 音频" data-url="http://yoursite.com/android-media-001/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="乐信圣文" />
          <p class="site-author-name" itemprop="name">乐信圣文</p>
          <p class="site-description motion-element" itemprop="description">集大家之成，悟小家之道。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">49</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="http://www.gov.cn/" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#第一节-基础概念"><span class="nav-number">1.</span> <span class="nav-text">第一节 基础概念</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第二节-音频采集"><span class="nav-number">2.</span> <span class="nav-text">第二节 音频采集</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第三节-开始录音"><span class="nav-number">3.</span> <span class="nav-text">第三节 开始录音</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MediaRecorder"><span class="nav-number">3.1.</span> <span class="nav-text">MediaRecorder</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AudioRecord"><span class="nav-number">3.2.</span> <span class="nav-text">AudioRecord</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">乐信圣文</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"cutler"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("sGcgYofeKOFi2l1XvGrm0PcP-gzGzoHsz", "Sx0mWxj4pkXYm17zT0UnV5Ca");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
